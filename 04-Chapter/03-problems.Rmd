---
title: "Discounted Cash Flow Valuation"
subtitle: "Questions and Problems"
author: "Ross, Westerfield, Jaffe"
output: 
  pdf_document:
   toc: true 
---

```{r setup, echo=F, message=F}
require(tidyverse)
require(kableExtra)
pretty <- function(x, n = 2) format(round(x, n), big.mark=",", nsmall = n)
  # Does not work inside TeX mathematical formulas (needs to be escaped.)
currency <- function(x, n = 2) paste0('$', pretty(x, n))
percent <- function(x, a = 0.01) scales::percent(x, accuracy = a)
ktable <- function(df, caption=NULL) {
  knitr::kable(df, caption=caption, format = "latex", booktabs=T) %>%
    kable_styling(latex_options = c("HOLD_position"))
}
options(scipen = 999)
```

# 1. Simple interest versus compound interest

First City Bank pays 8 percent simple interest on its savings account balances,
whereas Second City Bank pays 8 percent interest compounded annually. If you
made a \$5,000 deposit in each bank, how much more money would you earn from
your Second City Bank account at the end of 10 years?

---

```{r question 1; setup, echo=F}
p1 <- new.env()
p1$r <- .08
p1$deposit <- 5000
p1$years <- 10
p1$simple <- p1$deposit * (1 + p1$years * p1$r)
p1$compound <- p1$deposit * (1 + p1$r)^(p1$years)
p1$difference <- abs(p1$simple - p1$compound)
```

For a \$5,000 deposit in First Bank with simple interest you simply calculate
the value of the deposit as such:


$$
\begin{aligned}
\text{Simple interest} &= C \cdot (1 + n \times r)\\
 &= \$`r pretty(p1$deposit, 0)` \times (1 + `r p1$years` \times `r p1$r`)\\
 &= \$`r pretty(p1$simple, 0)`
\end{aligned}
$$

Second Bank uses compound interest.

$$
\begin{aligned}
\text{Compound interest} &= C \cdot (1 + r)^{n}\\
 &= \$`r pretty(p1$deposit, 0)` \times (1 + `r p1$r`)^{`r p1$years`}\\
 &= \$`r pretty(p1$compound, 0)`
\end{aligned}
$$

The difference between the two is:

$$
\$`r pretty(p1$compound, 0)` - \$`r pretty(p1$simple, 0)` = \$`r pretty(p1$difference, 0)`
$$

---

# 2. Calculating future values

Compute the future value of \$1,000 compounded annually for

a. 10 years at 5 percent.

b. 10 years at 10 percent.

c. 20 years at 5 percent.

d. Why is the interest earned in part (c) not twice the amount earned 
   in part (a)?

---

```{r problem 2; setup, echo=F}
p2 <- new.env()
p2$C <- 1000
p2$years <- c(10, 10, 20)
p2$rate <- c(.05, .1, .05)
p2$future.value <- p2$C * (1 + p2$rate)^(p2$years)
```

The future value of an investment can be computed:

$$
\text{FV} = C_0 \times (1 + r)^t
$$

$$
\begin{aligned}
\mathbf{A}:\ & `r pretty(p2$C, 0)`
  \times (1 + `r p2$rate[1]`)^{`r p2$years[1]`}\\
  &= `r pretty(p2$future.value[1])`\\\\
\mathbf{B}:\ & `r pretty(p2$C, 0)`
  \times (1 + `r p2$rate[2]`)^{`r p2$years[2]`}\\
  &= `r pretty(p2$future.value[2])`\\\\
\mathbf{C}:\ & `r pretty(p2$C, 0)`
  \times (1 + `r p2$rate[3]`)^{`r p2$years[3]`}\\
  &= `r pretty(p2$future.value[3])`\\\\
\end{aligned}
$$

The interest in part (c) is not twice the amount earned in part (a) because
compound interest grows exponentially, not linearly. Over longer periods, the
interest itself earns additional interest, which accelerates the growth of the
future value. This effect, called "compounding," results in a higher future
value for part (c) than simply doubling the future value from part (a).  If the
interest were simple (not compounded), then the earnings in part (c) would
indeed be twice those in part (a).

Book: (a) \$1,628.89, (b) \$2,593.74, (c) \$2,653.30

---

# 3. Calculating present values

For each of the following, compute the present value:

```{r problem 3; setup, echo=F}
p3 <- new.env()
p3$years <- c(6, 9, 18, 23)
p3$interest.rate <- c(.07, .15, .11, .18)
p3$future.value <- c(13827, 43852, 725380, 590710)
p3$present.value <- rep('-', 4)

p3$tbl <- tibble(
  present.value=p3$present.value,
  years=p3$years,
  interest.rate=percent(p3$interest.rate, 1),
  future.value=currency(p3$future.value, 0),
)
ktable(p3$tbl)
```

```{r problem 3; solution, echo=F}
p3$pv <- round(p3$future.value /
  (1 + p3$interest.rate)^(p3$years))
p3$tbl$present.value <- currency(p3$pv, 0)
```

The formula for calculating the present value from the future value is:

$$
\begin{aligned}
\text{PV} &= \frac{\text{FV}}{(1 + r)^t}\\\\
\text{PV}_{\text{6 years}} &= \frac{\$`r pretty(p3$future.value[1], 0)`}
  {`r p3$interest.rate[1]`} = \$`r pretty(p3$pv[1], 0)`\\\\
\text{PV}_{\text{9 years}} &= \frac{\$`r pretty(p3$future.value[2], 0)`}
  {`r p3$interest.rate[2]`} = \$`r pretty(p3$pv[2], 0)`\\\\
\text{PV}_{\text{18 years}} &= \frac{\$`r pretty(p3$future.value[3], 0)`}
  {`r p3$interest.rate[3]`} = \$`r pretty(p3$pv[3], 0)`\\\\
\text{PV}_{\text{23 years}} &= \frac{\$`r pretty(p3$future.value[4], 0)`}
  {`r p3$interest.rate[4]`} = \$`r pretty(p3$pv[4], 0)`\\\\
\end{aligned}
$$

```{r problem 3; table, echo=F}
ktable(p3$tbl)
```

---

# 4. Calculating interest rates

Solve for the unknown interst rate in each of the following:

```{r problem 4; setup, echo=F}
p4 <- new.env()
p4$years = c(4, 8, 16, 27)
p4$present.value = c(242, 410, 51700, 18750)
p4$future.value = c(307, 896, 162181, 483500)
p4$tbl <- tibble(
  present.value=currency(p4$present.value, 0),
  years=p4$years,
  interest.rate=rep('-', length(years)),
  future.value=currency(p4$future.value, 0)
)
ktable(p4$tbl)
```

---

To calculate the interest rate, we solve for $r$:

$$
\begin{aligned}
\text{FV} &= \text{PV} \times (1 + r)^t\\\\
\frac{\text{FV}}{\text{PV}} &= (1 + r)^t\\\\
\left( \frac{\text{FV}}{\text{PV}} \right)^{1/t} &= 1 + r\\\\
r &= \left( \frac{\text{FV}}{\text{PV}} \right)^{1/t} - 1
\end{aligned}
$$

```{r problem 4; solution, echo=F}
p4$interest.rate <- (p4$future.value / p4$present.value)^(1/(p4$years)) - 1
p4$cols <- colnames(p4$tbl)
p4$tbl <- cbind(p4$tbl, percent(p4$interest.rate, 0.01))
colnames(p4$tbl) <- c(p4$cols, 'interest.rate')
ktable(p4$tbl)
```

### NOTE:

The solution to this problem is the same as calculating the compound annual
growth rate (CAGR):

$$
\mathbf{CAGR} = \left(\frac{\text{ending value}}
  {\text{beginning value}}\right)^{1/t} - 1
$$

Book: 6.13\%, 10.27\%, 7.41\%, 12.79\%.

---

# 5. Calculating the number of periods

Solve for the years:

```{r problem 5, echo=F}
p5 <- new.env()
p5$present.value = c(625, 810, 18400, 21500)
p5$interest.rate = c(.09, .11, .17, .08)
p5$future.value = c(1284, 4341, 402662, 173439)

p5$tbl <- tibble(
  present.value = currency(p5$present.value, 0),
  interest.rate = percent(p5$interest.rate, 1),
  future.value  = currency(p5$future.value, 0),
  years         = rep('-', length(present.value)),
)
ktable(p5$tbl)
```

---

We solve for the period:

$$
\begin{aligned}
\text{FV} &= \text{PV} \times (1 + r)^t\\\\
\frac{\text{FV}}{\text{PV}} &= (1 + r)^t\\\\
\ln{\left(\frac{\text{FV}}{\text{PV}} \right)} &= t \ln{(1 + r)}\\\\
t &= \frac{\ln{\left(\frac{\text{FV}}{\text{PV}} \right)}}{\ln{(1 + r)}}
\end{aligned}
$$

```{r solution 5, echo=F}
p5$years <- log(p5$future.value/p5$present.value) /
            log(1 + p5$interest.rate)
p5$tbl$years <- round(p5$years, 2)
ktable(p5$tbl)
```

---

# 6. Calculating the number of periods

At 8 percent interest, how long does it take to double your money? To quadruple
it?

---

This depends on if we want to use simple or compound interest.

### Simple interest

#### Double

$$
\begin{aligned}
2X &= X (1 + t \cdot .08)\\
2 &= 1 + t \cdot .08\\
\frac{1}{.08} &= t\\
t &= 12.5
\end{aligned}
$$

For simple interest, it will take 12.5 periods to double.

#### Quadruple

$$
t = \frac{4 - 1}{.08} = 37.5
$$

It will take 37.5 periods to quadruple.

### Compound interest

#### Double

$$
\begin{aligned}
2X &= X \times (1.08)^t\\
2 &= (1.08)^t\\
\ln{2} &= t \ln{1.08}\\
t &= \frac{\ln{2}}{\ln{1.08}}\\\\
t &= 9
\end{aligned}
$$

With compound interest it takes about 9 periods to double.

### Quadruple

$$
t = \frac{\ln{4}}{\ln{1.08}} = 18
$$

It will take 18 periods to quadruple.

---

# 7. Calculating present values

Imprudential, Inc., has an unfunded pension liability of \$630 million that must
be paid in 20 years. To assess the value of the firm's stock, financial analysts
want to discount this liability back to the present. If the relevant discount
rate is 7.1 percent, what is the present value of this liability?

---

```{r problem 7; setup, echo=F}
p7 <- new.env()
p7$pension <- 630
p7$years <- 20
p7$discount <- .071
p7$present.value <- p7$pension/(1 + p7$discount)^(p7$years)
```

$$
\begin{aligned}
\text{PV} &= \frac{\text{FV}}{(1 + r)^t}\\
  &= \frac{\$`r pretty(p7$pension, 0)`}{(1 + `r p7$discount`)^{`r p7$years`}}\\
  &= \$`r pretty(p7$present.value, 0)`
\end{aligned}
$$

The liability is presently worth `r currency(p7$present.value, 0)` million.

---

# 8. Calculating rates of return

Although appealing to more refined tastes, art as a collectible has not always
performed so profitably. During 2010, Deutscher-Menzies sold _Arkies under the
Shower_, a painting by renowned Australian painter Brett Whiteley, at auction
for a price of \$1,100,000. Unfortunately for the previous owner, he had
purchased it three years earlier at a price of \$1,680,000. What was his annual
rate of return on this painting?

---

```{r problem 8; setup, echo=F}
p8 <- new.env()
p8$ending.value = 1.1e6
p8$beginning.value = 1.68e6
p8$years = 3
p8$ratio = p8$ending.value / p8$beginning.value
p8$rate = p8$ratio^(1/p8$years) - 1
```

To calculate the annual rate of return we use the following formula:

$$
r = \left(\frac{\text{FV}}{\text{PV}}\right)^{1/t} - 1
$$

$$
\begin{aligned}
r &= \left(\frac{\$`r pretty(p8$ending.value, 0)`}
  {\$`r pretty(p8$beginning.value, 0)`}\right)^{(1/3)} - 1\\
  &= `r percent(p8$rate)`
\end{aligned}
$$

Alternatively we could have used `R`'s `uniroot` function. Using the future
value formula and setting the left side to zero.

$$
\begin{aligned}
\text{FV} &= \text{PV} \times (1 + r)^{t}
0 &= \text{PV} \times (1 + r)^{t} - \text{FV}
\end{aligned}
$$

```{r problem 8; uniroot solution, echo=T}
p8$f <- function(r) p8$beginning.value * (1 + r)^p8$years - p8$ending.value
percent(p8$r <- uniroot(p8$f, upper=1, lower=-1, tol=1e-4)$root)
```

The annual rate of return is `r percent(p8$r)`.

---

# 9. Perpetuities

An investor purchasing a British consol is entitled to receive annual payments
from the British government forever. What is the price of a consol that pays
\$150 annually if the next payment occurs one year from today? The market
interest rate is 4.6 percent.

---

```{r problem 9; setup, echo=F}
p9 <- new.env()
p9$C <- 150
p9$rate <- .046
p9$perpetuity <- p9$C / p9$rate
p9$perpetuity.next.pay <- p9$C + p9$C / p9$rate
```

$$
\begin{aligned}
\text{PV} &= \frac{C}{r}\\
  &= \frac{\$`r p9$C`}{`r p9$rate`}\\
  &= \$`r pretty(p9$perpetuity)`
\end{aligned}
$$

__NOTE:__

The value of the consol will depend on when the next payment is. For example,
instead of the next payment being one year from now, what if the next payment
was tomorrow instead? What is the new present value of the consol? Well, since
the next payment is tomorrow then we have to include the next payment into the
calculation. The present value is calculated:

$$
\begin{aligned}
\text{PV}_{\text{pay tomorrow}} &= \$`r p9$C` + \frac{\$`r p9$C`}{`r p9$rate`}\\
  &= \$`r pretty(p9$perpetuity.next.pay)`
\end{aligned}
$$

You can see this dynamic play out in the stock market with stocks that pay
dividends. Just after the ex-dividend date, the stock price will drop according
to the value the stock's dividend (its cash dispursments to shareholders).

---

# 10. Continuous compounding

Compute the future value of \$1,900 continuously compounded for:

a. 7 years at a stated annual interest rate of 12 percent.
b. 5 years at a stated annual interest rate of 10 percent.
c. 12 years at a stated annual interest rate of 5 percent.
d. 10 years at a stated annual interest rate of 7 percent.

---

```{r problem 10; setup, echo=F}
p10 <- new.env()
p10$pv <- 1900
p10$n <- c(7, 5, 12, 10)
p10$r <- c(.12, .1, .05, .07)
p10$fv <- p10$pv * exp(p10$n * p10$r)
```

Continuous compounding

$$
C_0 \times e^{rT}
$$

$$
\begin{aligned}
\mathbf{A}:\ &\ \$`r pretty(p10$pv, 0)`
  \times e^{`r p10$r[1]` \times `r p10$n[1]`}\\
  &= \$`r pretty(p10$fv[1])`\\\\
\mathbf{B}:\ &\ \$`r pretty(p10$pv, 0)`
  \times e^{`r p10$r[2]` \times `r p10$n[2]`}\\
  &= \$`r pretty(p10$fv[2])`\\\\
\mathbf{C}:\ &\ \$`r pretty(p10$pv, 0)`
  \times e^{`r p10$r[3]` \times `r p10$n[3]`}\\
  &= \$`r pretty(p10$fv[3])`\\\\
\mathbf{D}:\ &\ \$`r pretty(p10$pv, 0)`
  \times e^{`r p10$r[4]` \times `r p10$n[4]`}\\
  &= \$`r pretty(p10$fv[4])`\\\\
\end{aligned}
$$

Book: (a) \$4,401.10, (b) \$3,132.57, (c) \$3,462.03, (d) \$3,826.13.

---

# 11. Present value and multiple cash flows

Conoly Co. has identified an investment project with the following cash flows.
If the discount rate is 10 percent, what is the present value of these cash
flows? What is the present value at 18 percent? At 24 percent?

```{r problem 11; setup, echo=F}
p11 <- new.env()
p11$year <- c(1, 2, 3, 4)
p11$cf <- c(960, 840, 935, 1350)
p11$r <- c(.1, .18, .24)

p11$tbl <- tibble(
  year = p11$year,
  cash.flow = currency(p11$cf),
)

ktable(p11$tbl)
p11$pv.f <- function(r) sum(p11$cf / (1 + r)^(p11$year))
p11$pv <- unlist(lapply(p11$r, p11$pv.f))
```

---

The formula for present value:

$$
\text{PV} = \sum^I_{i=1}{\frac{\text{FV}_{i}}{(1 + r)^{t_{i}}}}
$$

Where:

* $\text{FV}_{i}$ is the future values of each cash flow.
* $t_i$ is the number of years til the cash flow is realized.

For a rate of 10 percent the cash flows are:

$$
\text{PV} =
    \frac{\$`r p11$cf[1]`}{(1 + `r p11$r[1]`)^{`r p11$year[1]`}}
  + \frac{\$`r p11$cf[2]`}{(1 + `r p11$r[1]`)^{`r p11$year[2]`}}
  + \frac{\$`r p11$cf[3]`}{(1 + `r p11$r[1]`)^{`r p11$year[3]`}}
  + \frac{\$`r p11$cf[4]`}{(1 + `r p11$r[1]`)^{`r p11$year[4]`}}
  = \$`r pretty(p11$pv[1], 0)`
$$

For a rate of 18 percent:

$$
\text{PV} =
    \frac{\$`r p11$cf[1]`}{(1 + `r p11$r[2]`)^{`r p11$year[1]`}}
  + \frac{\$`r p11$cf[2]`}{(1 + `r p11$r[2]`)^{`r p11$year[2]`}}
  + \frac{\$`r p11$cf[3]`}{(1 + `r p11$r[2]`)^{`r p11$year[3]`}}
  + \frac{\$`r p11$cf[4]`}{(1 + `r p11$r[2]`)^{`r p11$year[4]`}}
  = \$`r pretty(p11$pv[2], 0)`
$$

For a rate of 24 percent:

$$
\text{PV} =
    \frac{\$`r p11$cf[1]`}{(1 + `r p11$r[3]`)^{`r p11$year[1]`}}
  + \frac{\$`r p11$cf[2]`}{(1 + `r p11$r[3]`)^{`r p11$year[2]`}}
  + \frac{\$`r p11$cf[3]`}{(1 + `r p11$r[3]`)^{`r p11$year[3]`}}
  + \frac{\$`r p11$cf[4]`}{(1 + `r p11$r[3]`)^{`r p11$year[4]`}}
  = \$`r pretty(p11$pv[3], 0)`
$$

We will calculate for each of the different discount rates:

* The present value of the cash flows at 10 percent: \$`r pretty(p11$pv[1])`

* The present value of the cash flows at 18 percent: \$`r pretty(p11$pv[2])`

* The present value of the cash flows at 24 percent: \$`r pretty(p11$pv[3])`

---

# 12. Present value and multiple cash flows

Investment X offers to pay you \$4,500 per year for nine years, whereas
Investment Y offers to pay you \$7,000 per year for five years. Which of these
cash flow streams has the higher present value if discount rate is 5 percent? If
the discount rate is 22 percent?

---

```{r problem 12; setup, echo=F}
p12 <- new.env()
p12$X.cf <- 4500
p12$X.n <- 9
p12$Y.cf <- 7000
p12$Y.n <- 5
p12$r <- c(.05, .22)
p12$pvia <- function(r, n) sum(1 / (1 + r)^(1:n))
p12$X.pv <- p12$X.cf * unlist(lapply(p12$r, p12$pvia, p12$X.n))
p12$Y.pv <- p12$Y.cf * unlist(lapply(p12$r, p12$pvia, p12$Y.n))
```

## Given

* Investment X cash flow: \$`r pretty(p12$X.cf, 0)`

* Term for investment X: `r p12$X.n` years

* Investment Y cash flow: \$`r pretty(p12$Y.cf, 0)`

* Term for investment Y: `r p12$Y.n` years

* Discount rates: 5\% and 22\%.

We solve this with the annuity equation:

$$
\begin{aligned}
\text{PV}_{\text{annuity}} &= C \cdot \left[\frac{1 - (1 + r)^{-T}}{r}\right]
\end{aligned}
$$

### For discount rate 5\%

$$
\begin{aligned}
\text{PV}_{\text{X}} &= `r pretty(p12$X.cf, 0)`
  \times \left[\frac{1 - (`r 1+p12$r[1]`)^{- `r p12$X.n`}}{`r p12$r[1]`}\right]\\
  &= `r pretty(p12$X.pv[1])`\\\\
\text{PV}_{\text{Y}} &= `r pretty(p12$Y.cf, 0)`
  \times \left[\frac{1 - (`r 1+p12$r[1]`)^{- `r p12$Y.n`}}{`r p12$r[1]`}\right]\\
  &= `r pretty(p12$Y.pv[1])`
\end{aligned}
$$

For the lower discount rate, the longer timespan makes investment X more
attractive.

### For discount rate 22\%

$$
\begin{aligned}
\text{PV}_{\text{X}} &= `r pretty(p12$X.cf, 0)`
  \times \left[\frac{1 - (`r 1+p12$r[2]`)^{- `r p12$X.n`}}{`r p12$r[2]`}\right]\\
  &= `r pretty(p12$X.pv[2])`\\\\
\text{PV}_{\text{Y}} &= `r pretty(p12$Y.cf, 0)`
  \times \left[\frac{1 - (`r 1+p12$r[2]`)^{- `r p12$Y.n`}}{`r p12$r[2]`}\right]\\
  &= `r pretty(p12$Y.pv[2])`
\end{aligned}
$$

However, for higher discount rates, the longer timeframe reduces the
contribution of the cash flows further out. Thus, investment Y is a better
choice.

---

# 13. Calculating annuity present value

An investment offers \$4,900 per year for 15 years, with the first payment
occurring one year from now. If the required return is 8 percent, what is the
value of the investment? What would the value be if the payments occurred for 40
years? For 75 years? Forever?

---

```{r problem 13; setup, echo=F}
p13 <- new.env()
p13$cf <- 4900
p13$rate <- .08
p13$n <- c(15, 40, 75)
#p13$pv <- unlist(lapply(p13$n, function(n) sum(p13$cf/((1 + p13$rate)^(1:n)))))
p13$pv.f <- function(c, r, t) c * (1 - (1 + r)^-t) / r
p13$pv <- p13$pv.f(p13$cf, p13$rate, p13$n)
p13$pv.perpetuity <- p13$cf/p13$rate
```

$$
\begin{aligned}
\text{PV}_{\text{annuity}} &= \text{CF}
  \times \left[\frac{1 - (1 + r)^{-T}}{r}\right]\\\\
\text{PV}_{\text{15 years}} &= \$`r pretty(p13$cf, 0)`
  \times \left[
    \frac{1 - (1 + `r p13$rate`)^{- `r p13$n[1]`}}{`r p13$rate`}
  \right] \\
  &= \$`r pretty(p13$pv[1])`\\\\
\text{PV}_{\text{40 years}} &= \$`r pretty(p13$cf, 0)`
  \times \left[
    \frac{1 - (1 + `r p13$rate`)^{- `r p13$n[2]`}}{`r p13$rate`}
  \right] \\
  &= \$`r pretty(p13$pv[2])`\\\\
\text{PV}_{\text{75 years}} &= \$`r pretty(p13$cf, 0)`
  \times \left[
    \frac{1 - (1 + `r p13$rate`)^{- `r p13$n[3]`}}{`r p13$rate`}
  \right] \\
  &= \$`r pretty(p13$pv[3])`\\\\
\text{PV}_{\text{perpetuity}} &= \frac{CF}{r}
   = \frac{\$`r pretty(p13$cf, 0)`}{`r p13$rate`}\\
  &= \$`r pretty(p13$pv.perpetuity)`
\end{aligned}
$$

---

# 14. Calculating perpetuity value

The Perpetual Life Insurance Co. is trying to sell you an investment policy that
will pay you and your heirs \$15,000 per year forever. If the required return on
this investment is 5.2 percent, how much will you pay for the policy? Suppose
the Perpetual Life Insurance Co. told you the policy costs \$320,000. At what
interest rate would this be a fair deal?

---

```{r problem 14; setup, echo=F}
p14 <- new.env()
p14$cf <- 15000
p14$rate <- .052
p14$pv <- p14$cf / p14$rate
p14$pv.given <- 320000
p14$rate.calculated <- p14$cf / p14$pv.given
```

The perpetuity formula is:

$$
\begin{aligned}
\text{PV}_{\text{perpetuity}} &= \frac{C_0}{r}\\
  &= \frac{`r pretty(p14$cf, 0)`}{`r p14$rate`}\\
  &= \$`r pretty(p14$pv)`\\\\
\end{aligned}
$$

For a policy that costs \$320,000, the interest rate should be:

$$
\begin{aligned}
r &= \frac{C_0}{\text{PV}_{\text{perpetuity}}} \\
  &= \frac{`r pretty(p14$cf, 0)`}{`r pretty(p14$pv.given, 0)`}\\
  &= `r percent(p14$rate.calculated)`
  \%
\end{aligned}
$$

Book: \$88,461.54 (the book is wrong here), 4.69\%

---

# 15. Calculating EAR

Find the EAR in each of the following cases:

```{r problem 15; setup, echo=F}
p15 <- new.env()
p15$apr <- c(.07, .16, .11, .12)
p15$compound <- c(4, 12, 365, NA)
p15$tbl <- tibble(
  apr = percent(p15$apr, 1),
  compound = c("Quarterly", "Monthly", "Daily", "Infinite")
)
ktable(p15$tbl)
```

```{r problem 15; solution, echo=F}
# First three are not infinite
p15$ear <- (1 + p15$apr[1:3] / p15$compound[1:3])^(p15$compound[1:3]) - 1
# The infinite compounding uses a special formula
p15$ear <- c(p15$ear, exp(p15$apr[4]) - 1)
p15$cols <- colnames(p15$tbl)
p15$tbl <- cbind(p15$tbl, percent(p15$ear))
colnames(p15$tbl) <- c(p15$cols, "ear")
```
To calculate the EAR from the APR we need to know the compounding period. Then
we can use the following two formulas:

## Set period compounding (Quarterly, Monthly, Daily, etc...)

$$
\begin{aligned}
\text{EAR} &= \left(1 + \frac{r}{m}\right)^{m} - 1\\\\
\text{EAR}_{\text{7\% qtr}} &= \left(1 + \frac{`r p15$apr[1]`}
  {`r p15$compound[1]`}\right)^{`r p15$compound[1]`} - 1\\
  &= `r percent(p15$ear[1])`
  \%\\\\
\text{EAR}_{\text{16\% monthly}} &= \left(1 + \frac{`r p15$apr[2]`}
  {`r p15$compound[2]`}\right)^{`r p15$compound[2]`} - 1\\
  &= `r percent(p15$ear[2])`
  \%\\\\
\text{EAR}_{\text{11\% daily}} &= \left(1 + \frac{`r p15$apr[3]`}
  {`r p15$compound[3]`}\right)^{`r p15$compound[3]`} - 1\\
  &= `r percent(p15$ear[3])`
  \%\\\\
\end{aligned}
$$

## Infinite compounding

$$
\begin{aligned}
\text{EAR} &= e^r - 1\\\\
\text{EAR}_{\text{12\% continuous}} &= e^{`r p15$apr[4]`} - 1\\
  &= `r percent(p15$ear[4])`
  \%
\end{aligned}
$$

## Completed table

```{r problem 15; display  table, echo=F}
ktable(p15$tbl)
```

---

# 16. Calculating APR

Find the APR, or stated rate, in each of the following cases:

```{r problem 16; setup, echo=F}
p16 <- new.env()
p16$ear <- c(.098, .196, .083, .143)
p16$compound <- c(2, 12, 52, NA)

p16$tbl <- data.frame(
  ear = percent(p16$ear),
  compound = c("Semiannually", "Monthly", "Weekly", "Infinite")
)
ktable(p16$tbl)
```

---

```{r problem 16; solution, echo=F}
p16$apr <- p16$compound[1:3] * ((p16$ear[1:3] + 1)^(1/p16$compound[1:3]) - 1)
p16$apr <- c(p16$apr, log(p16$ear[4] + 1))
```

To calculate the APR from the EAR we work the EAR equation backwards to:

$$
\begin{aligned}
\text{APR}_{\text{noncontinuous}} &=
  m \times \left[\left(1 + \text{EAR}\right)^{\frac{1}{m}} - 1  \right]\\\\
\text{APR}_{\text{9.8\% semiannual}} &= 
  `r p16$compound[1]` \times
  \left[(1 + `r p16$ear[1]`)^{1/`r p16$compound[1]`} - 1\right]\\
  &= `r percent(p16$apr[1])`
  \%\\\\
\text{APR}_{\text{19.6\% monthly}} &= 
  `r p16$compound[2]` \times
  \left[(1 + `r p16$ear[2]`)^{1/`r p16$compound[2]`} - 1\right]\\
  &= `r percent(p16$apr[2])`
  \%\\\\
\text{APR}_{\text{8.3\% weekly}} &= 
  `r p16$compound[3]` \times
  \left[(1 + `r p16$ear[3]`)^{1/`r p16$compound[3]`} - 1\right]\\
  &= `r percent(p16$apr[3])`
  \%\\\\
\text{APR}_{\text{continous}} &= \ln{(1 + \text{EAR})}\\
  &= \ln{(1 + `r p16$ear[4]`)}\\
  &= `r percent(p16$apr[4])`
  \%\\\\
\end{aligned}
$$

```{r problem 16; display table, echo=F}
p16$tbl <- cbind(p16$tbl, percent(p16$apr))
colnames(p16$tbl)[3] <- "apr"
ktable(p16$tbl)
```

---

# 17. Calculating EAR

First National Bank charges 11.2 percent compounded monthly on its business
loans. First United Bank charges 11.4 percent compounded semiannually. As a
potential borrower, to which bank would you go for a new loan?

---

```{r problem 17; setup, echo=F}
p17 <- new.env()
p17$rate.national <- .112
p17$m.national <- 12
p17$ear.national <- (1 + p17$rate.national /
  p17$m.national)^(p17$m.national) - 1
p17$rate.united <- .114
p17$m.united <- 2
p17$ear.united <- (1 + p17$rate.united /
  p17$m.united)^(p17$m.united) - 1
```

$$
\begin{aligned}
\text{EAR} &= \left( 1 + \frac{r}{m}  \right)^m - 1\\\\
\text{EAR}_{\text{First National Bank}} &=
  \left(1 + \frac{`r p17$rate.national`}
  {`r p17$m.national`}\right)^{`r p17$m.national`} - 1\\
  &= `r percent(p17$ear.national)`
  \%\\\\
\text{EAR}_{\text{First United Bank}} &=
  \left(1 + \frac{`r p17$rate.united`}
  {`r p17$m.united`}\right)^{`r p17$m.united`} - 1 \\
  &= `r percent(p17$ear.united)`
  \%
\end{aligned}
$$

The EARs are similar for the two banks. However, I would get my loan from First
United Bank since the EAR rate is lower.

---

# 18. Interest rates

Well-known financial writer Andrew Tobias argues that he can earn 177 percent
per year buying wine by the case. Specifically, he assumes that he will consume
one \$10 bottle of fine Bordeaux per week for the next 12 weeks. He can either
pay \$10 per week or buy a case of 12 bottles today. If he buys the case, he
receives a 10 percent discount and, by doing so, earns the 177 percent. Assume
he buys the wine and consumes the first bottle today. Do you agree with his
analysis? Do you see a problem with his numbers?

---

```{r problem 18; setup, echo=F}
p18 <- new.env()
```

## Scenario Summary:

* Cost per bottle if paid weekly: $\$10 \times 12 = \$120$

* Cost for buying a case today (10\% discount): $\$120 \times 0.90 = \$108$

* Savings: \$12

* Wine is consumed weekly over 12 weeks.

* He drinks one bottle immediately (Week 0), then one each week until Week 11.

## Financial framing

The comparison is between two cash flow patterns:

1. Installment plan (implicit): \$10 per week for 12 weeks.

2. Upfront payment: \$108 now.

We can treat this like a loan: Tobias "invests" \$108 today to avoid paying
\$10/week for 12 weeks. The IRR of this investment tells us the effective
return.

## IRR caclulation:

We solve for the interest rate `r` that satisfies:

$$
108 = \sum^{11}_{t=0}{\frac{10}{(1 + r)^t}}
$$

This is the present value of a 12-week annuity of \$10 payments, discounted at
weekly rate `r`.

We can determine the rate using R's `uniroot`

```{r problem 18; show use of uniroot, echo=T}
p18$cost.per.bottle <- 10
p18$weeks <- 12
p18$discount <- .9
p18$savings <- p18$cost.per.bottle * p18$weeks * p18$discount
p18$t <- 0:(p18$weeks-1) # first bottle is consumed today.
f <- function(r) sum(p18$cost.per.bottle / (1 + r)^(p18$t)) - p18$savings
(p18$irr <- uniroot(f, upper=1, lower=.01, tol=1e-4)$root)
```

```{r problem 18; calculate ear, echo=F}
p18$ear <- (1 + p18$irr)^(52) - 1
```

To annualize:

$$
(1 + \text{IRR})^{52} - 1 = (1 + `r p18$irr`)^{52} - 1 = `r percent(p18$ear)`
\%
$$

However, it is misleading to compare this to an investment return---it's a rate
of savings on a fixed set of planned purchases.

Book: EAR = 176.68\%

---

# 19. Calculating number of periods

One of your customers is delinquent on his accounts payable balance. You've
mutually agreed to a repayment schedule of \$700 per month. You will charge 1.3
percent per month interest on the overdue balance. If the current balance is
\$21,500, how long will it take for the account to be paid off?

---

```{r problem 19; setup, echo=F}
p19 <- new.env()
p19$monthly.payment <- 700
p19$rate <- .013
p19$balance <- 21500
p19$n <- - (log(1 - (p19$balance * p19$rate)/(p19$monthly.payment))) /
            log(1 + p19$rate)
```

We are asked to determine how long it will take to pay off a \$21,500 debt if
the customer pays \$700 per month, and interest accrues at 1.3\% per month.

## This is a present value of an annuity problem

You are solving for n, the number of months needed to pay off the loan, given:

* Present value (PV): \$21,500

* Payment (PMT): \$700

* Monthly interest rate (r): .013 (1.3\%)

Solving for $n$:

$$
\begin{aligned}
\text{\text{PV}} &= C \left[\frac{1 - (1 + r)^{-n}}{r}\right]\\
\frac{\text{PV}}{C} &= \frac{1 - (1 + r)^{-n}}{r}\\
\frac{\text{PV} \cdot r}{C} &= 1 - (1 + r)^{-n}\\
(1 + r)^{-n} &= 1 - \frac{\text{PV} \cdot r}{C}\\
-n \ln{(1 + r)} &= \ln{\left(1 - \frac{\text{PV} \cdot r}{C}\right)}\\\\
n &= - \frac{\ln{\left(1 - \frac{\text{PV} \cdot r}{C}\right)}}
  {\ln{(1 + r)}}\\
  &= - \frac{\ln{\left(1 - \frac{`r pretty(p19$balance, 0)` \times `r p19$rate`}
  {`r p19$monthly.payment`}\right)}}{\ln{(1 + `r p19$rate`)}}\\
  &= `r round(p19$n, 2)`\ \text{months}
\end{aligned}
$$

---

# 20. Calculating EAR

Friendly's Quick Loans, Inc., offers you "three for four or I knock on your
door." This means you get \$3 today and repay \$4 when you get your paycheck in
one week (or else). What's the effective annual return Friendly's earns on this
lending business? If you were brave enough to ask, what APR would Friendly's say
you were paying?

---

```{r problem 20; setup, echo=F}
p20 <- new.env()
p20$pv <- 3
p20$fv <- 4
p20$r <- p20$fv / p20$pv - 1
p20$apr <- p20$r * 52
p20$ear <- (1 + p20$r)^(52) - 1
```

Find the weekly interest rate:

$$
\begin{aligned}
\text{PV} &= \frac{\text{FV}}{1 + r}\\
r &= \frac{\text{FV}}{\text{PV}} - 1\\
  &= \frac{`r p20$fv`}{`r p20$pv`} - 1\\
  &= `r round(p20$r, 2)`
\end{aligned}
$$

Convert to APR:

$$
\begin{aligned}
\text{APR} &= r_{\text{weekly}} \times 52\\
  &= `r round(p20$r, 2)` \times 52\\
  &= `r round(p20$apr, 3)`
\end{aligned}
$$

Find the EAR:

$$
\begin{aligned}
\text{EAR} &= (1 + r_{\text{weekly}})^{52} - 1\\
  &= (1 + `r round(p20$r, 2)`)^{52} - 1\\
  &= `r pretty(p20$ear, 0)`\ \text{percent}
\end{aligned}
$$

---

# 21. Future value

What is the future value in six years \$1,000 invested in an account with a
stated annual interest rate of 9 percent,

a. Compounded annually?
b. Compounded semiannually?
c. Compounded monthly?
d. Compounded continuously?
e. Why does the future value increase as the compounding period shortens?

---

```{r problem 21; setup, echo=F}
p21 <- new.env()
p21$t <- 6
p21$pv <- 1000
p21$r <- .09
p21$m <- c(1, 2, 12)
p21$fv <- p21$pv * (1 + p21$r / p21$m )^(p21$m * p21$t)
p21$fv <- c(p21$fv, p21$pv * exp(p21$r * p21$t))
```

We use the future value formula with different compounding periods:

$$
\begin{aligned}
\text{FV} &= \text{PV} \times (1 + \frac{r}{m})^{mt}\\\\
\text{FV}_{\text{annually}} &= \$`r pretty(p21$pv, 0)`
  \times (1 + `r p21$r`/ `r p21$m[1]`)^{`r p21$m[1]` \times `r p21$t`}\\
  &= \$`r pretty(p21$fv[1])`\\\\
\text{FV}_{\text{semiannually}} &= \$`r pretty(p21$pv, 0)`
  \times (1 + `r p21$r`/ `r p21$m[2]`)^{`r p21$m[2]` \times `r p21$t`}\\
  &= \$`r pretty(p21$fv[2])`\\\\
\text{FV}_{\text{monthly}} &= \$`r pretty(p21$pv, 0)`
  \times (1 + `r p21$r`/ `r p21$m[3]`)^{`r p21$m[3]` \times `r p21$t`}\\
  &= \$`r pretty(p21$fv[3])`\\\\
\text{FV}_{\text{continuous}} &= \text{PV}\  e^{rT}\\
  &= \$`r pretty(p21$pv, 0)`\  e^{`r p21$r` \times `r p21$t`}\\
  &= \$`r pretty(p21$fv[4])`
\end{aligned}
$$

The future value increases as the compounding period shortens because interest
is being calculated and added to the balance more frequently. This causes the
investment to earn "interest on interest" sooner and more often, resulting in a
higher overall return. Continuous compounding is the theoretical maximum for
compounding, as it assumes interest is added at every possible instant.

---

# 22. Simple interest versus compound interest

First Simple Bank pays 5 percent simple interest on its investment accounts. If
First Complex Bank pays interest on its accounts compounded annually, what rate
should the bank set if it wants to match First Simple Bank over an investment
horizon of 10 years?

---

```{r problem 22; setup, echo=F}
p22 <- new.env()
p22$r.simple <- .05
p22$t <- 10
p22$r.complex <- (1 + p22$r.simple * p22$t)^(1 / p22$t) - 1
```

We simply equate each banks interest rate structure to each other and determine
what First Complex Bank should set their rate to.

Simple interest (First Simple Bank):

$$
\begin{aligned}
\text{FV}_{\text{simple}} &= \text{PV} \times ( 1 + r_{\text{simple}} \times t)
\end{aligned}
$$

Compound interest (First Comples Bank):

$$
\begin{aligned}
\text{FV}_{\text{complex}} &= \text{PV} \times (1 + r_{\text{complex}})^t
\end{aligned}
$$

Equate both to each other and solve for $r_{\text{complex}}$:

$$
\begin{aligned}
(1 + r_{\text{simple}} \times t) &= (1 + r_{\text{complex}})^{t}\\
(1 + r_{\text{simple}} \times t)^{1/t} &= 1 + r_{\text{complex}}\\\\
r_{\text{complex}} &= (1 + r_{\text{simple}} \times t)^{1/t} - 1\\
 &= (1 + `r p22$r.simple` \times `r p22$t`)^{1 / `r p22$t`} - 1\\
 &= `r percent(p22$r.complex)`
 \%
\end{aligned}
$$

Book: 4.14\%

---

# 23. Calculating annuities

You are planning to save for retirement over the next 30 years. To do this, you
will invest \$800 a month in a stock account and \$350 a month in a bond
account. The return of the stock account is expected to be 11 percent, and the
bond account will pay 6 percent. When you retire, you will combine your money
into an account with an 8 percent return. How much can you withdraw each month
from your account assuming a 25-year withdrawal period?

---

```{r problem 23; setup, echo=F}
p23 <- new.env()
p23$cf.stock <- 800
p23$cf.bond <- 350
p23$n.contribution <- 30
p23$n.withdrawal <- 25
p23$r.stock <- .11
p23$r.bond <- .06
p23$r.withdrawal <- .08
p23$fv.stock <- p23$cf.stock *
  ((1 + (p23$r.stock/12))^(12 * p23$n.contribution) - 1) /
  (p23$r.stock / 12)
p23$fv.bond <- p23$cf.bond *
  ((1 + (p23$r.bond/12))^(12 * p23$n.contribution) - 1) /
  (p23$r.bond / 12)
p23$fv.combined <- p23$fv.stock + p23$fv.bond
p23$fv.withdrawal <- p23$fv.combined *
  (p23$r.withdrawal / 12) /
  (1 - (1 + p23$r.withdrawal / 12)^(- 12 * p23$n.withdrawal))
t <- 1:30
```

__NOTE__: The following shows the process of deriving the annuity formula from
the geometric series formula of the future value. This is not necessary for
answering the problem. Just use the annuity formula. This should be in an
appendix.

The future value of all the contributions can be calculated:

$$
\begin{aligned}
\text{FV} &= C \cdot \sum^N_{n=1}{\left(1 + \frac{r}{m}\right)^{(n-1)}}
\end{aligned}
$$

Where $N = mT$ or the number of years multiplied by the number of months
(monthly compounding).

This is a geometric series that can be broken down:

$$
\begin{aligned}
\text{FV} &= C + C(1 + r/m) + C(1 + r/m)^2 + \cdots + C(1 + r/m)^{(n - 1)}\\\\
(1 + r/m)\ \text{FV} &= C(1 + r/m) + C(1 + r/m)^2 + \cdots + C(1 + r/m)^n\\\\
\text{FV} - (1 + r/m)\ \text{FV} &= C + C(1 + r/m)^n\\\\
\text{FV}\ (1 - (1 + r/m)) &= C (1 - (1 + r/m)^n)\\\\
\text{FV} &= C \cdot \frac{(1 - (1 + r/m)^n)}{1 - (1 + r/m)}\\\\
\text{FV} &= C \cdot \left[\frac{(1 + r/m)^n - 1}{r/m}\right]
\end{aligned}
$$


### Saving for retirement

We calculate the contribution, each month, over a 30 year window. The stock
account will return 11 percent a year, and the bond account will return 6
percent a year.

$$
\begin{aligned}
\text{FV}_{\text{stock}} &= \$`r p23$cf.stock` \times
  \left[
    \frac{(1 + \frac{`r p23$r.stock`}{12})^{(12 \times `r p23$n.contribution`)}
    - 1}{\frac{`r p23$r.stock`}{12}}
  \right]\\
  &= \$`r pretty(p23$fv.stock)`\\\\
\text{FV}_{\text{bond}} &= \$`r p23$cf.bond` \times
  \left[
    \frac{(1 + \frac{`r p23$r.bond`}{12})^{(12 \times `r p23$n.contribution`)}
    - 1}{\frac{`r p23$r.bond`}{12}}
  \right]\\
  &=  \$`r pretty(p23$fv.bond)`\\\\
\text{FV}_{\text{combined}} &=  \$`r pretty(p23$fv.stock)`
  + \$`r pretty(p23$fv.bond)`\\
  &= \$`r pretty(p23$fv.combined)`
\end{aligned}
$$

### Withdrawals during retirement

We use the annuity equation and solve for the withdrawal cash flows ($W$).

$$
\begin{aligned}
\text{PV} &= W \times
  \frac{1 - \left(1 + \frac{r}{m}\right)^{-mT}}{\frac{r}{m}}\\\\
\text{W} &= \text{PV} \times
  \frac{\frac{r}{m}}{1 - \left(1 + \frac{r}{m}\right)^{-mT}}\\
  &= \$`r pretty(p23$fv.combined)` \times \frac{\frac{`r p23$r.withdrawal`}{12}}
  {1 - (1 + \frac{`r p23$r.withdrawal`}
  {12})^{-(12 \times `r p23$n.withdrawal`)}}\\
  &= \$`r pretty(p23$fv.withdrawal)`
\end{aligned}
$$

---

# 24. Calculating rates of return

Suppose an investment offers to quadruple your money in 12 months (don't believe
it). What rate of return per quarter are you being offered?

---

```{r problem 24; setup, echo=F}
p24 <- new.env()
```

We need to find the rate of return that satisfies the following equation:

$$
\begin{aligned}
(1 + r_q)^4 &= 4\\
r_q &= 4^{1/4} - 1\\
r_q &= 41.42\%
\end{aligned}
$$

Using `R`'s `uniroot` to find $r_q$:

```{r problem 24; show uniroot, echo=T}
p24$fv <- 4
p24$f <- function(r) (1 + r)^(4) - 4
(p24$r <- uniroot(p24$f, c(.01, 1))$root)
```

The return rate for an investment that quadruples your money in 12 months,
compounded quarterly, is: `r percent(p24$r)`.

---

# 25. Calculating rates of return

You're trying to choose between two different investments, both of which have
up-front costs of \$65,000. Investment G returns \$125,000 in six years.
Investment H returns \$185,000 in 10 years. Which of these investments has the
higher return?

---

```{r problem 25; setup, echo=F}
p25 <- new.env()
p25$pv = 65000
p25$fv = c(125000, 185000)
p25$n = c(6, 10)
p25$matrix = matrix(c(p25$n, p25$fv), ncol=2)
p25$f <- function(r, n, fv) p25$pv * (1 + r)^n - fv
p25$r = apply(p25$matrix, 1,
    function(x) uniroot(p25$f, n=x[1], fv=x[2], c(.01, 1))$root)
```

We need to find the rate of return for two investments have an up-front cost of
\$65,000. We can use the future value formula to find `r`:

$$
\begin{aligned}
\text{FV} &= \text{PV} \times (1 + r)^n\\
\frac{\text{FV}}{\text{PV}} &= (1 + r)^n\\
\left(\frac{\text{FV}}{\text{PV}}\right)^{1/n} &= 1 + r\\
r &= \left(\frac{\text{FV}}{\text{PV}}\right)^{1/n} - 1
\end{aligned}
$$

### Investment G: return of \$125,000 in six years.

$$
\begin{aligned}
r_{G} &= \left(\frac{`r pretty(p25$fv[1])`}
  {`r pretty(p25$pv)`}\right)^{1/`r p25$n[1]`}- 1\\
  &= `r percent(p25$r[1])`
  \%
\end{aligned}
$$

### Investment H: return of \$185,000 in 10 years.

$$
\begin{aligned}
r_{H} &= \left( \frac{`r pretty(p25$fv[2])`}
  {`r pretty(p25$pv)`} \right)^{1/`r p25$n[2]`} - 1\\
  &= `r percent(p25$r[2])`
  \%
\end{aligned}
$$

We can also use `R`s `uniroot` function to find the returns:

```{r problem25; uniroot for investment 1, echo=T}
p25$f.G <- function(r) p25$pv * (1 + r)^p25$n[1] - p25$fv[1]
percent(p25$r.G <- uniroot(p25$f.G, upper=1, lower=.01, tol=1e-4)$root)
p25$f.H <- function(r) p25$pv * (1 + r)^p25$n[2] - p25$fv[2]
percent(p25$r.H <- uniroot(p25$f.H, upper=1, lower=.01, tol=1e-4)$root)
```

---

# 26. Growing perpetuities

Mark Weinstein has been working on an advanced technology in laser eye surgery.
His technology will be available in the near term. He anticipates his first
annual cash flow from the technology to be \$175,000, received two years from
today. Subsequent annual cash flows will grow at 3.5 percent in perpetuity. What
is the present value of the technology if the discount rate is 10 percent?

---

```{r problem 26; setup, echo=F}
p26 <- new.env()
p26$cf.0 <- 175000
p26$n.start <- 1
p26$growth <- .035
p26$discount <- .10
p26$pv.perpituity <- p26$cf.0 / (p26$discount - p26$growth)
# Discounted back to today.
p26$pv.discounted <- p26$pv.perpituity / (1 + p26$discount)^(p26$n.start)
```

We first calculate the present value at year 1:

$$
\begin{aligned}
\text{PV}_{\text{year 1}} &= \frac{C_0}{r - g}\\
  &= \frac{\$`r pretty(p26$cf.0)`}{`r p26$discount` - `r p26$growth`}\\
  &= \$`r pretty(p26$pv.perpituity)`
\end{aligned}
$$

Now we need to discount year 1 back to today:

$$
\begin{aligned}
\text{PV}_{\text{Today}} &= \frac{\text{PV}_{\text{year 1}}}{(1 + r)}\\
  &= \frac{\$`r pretty(p26$pv.perpituity)`}{(1 + `r p26$discount`)}\\
  &= \$`r pretty(p26$pv.discounted)`
\end{aligned}
$$

Book: \$2,477,552

---

# 27. Perpetuities

A prestigious investment bank designed a new security that pays a quarterly
dividend of \$4.50 in perpetuity. The first dividend occurs one quarter from
today. What is the price of the security if the stated annual interest rate
is 6.5 percent, compounded quarterly?

---

```{r problem 27; setup, echo=F}
p27 <- new.env()
p27$dividend <- 4.5
p27$m <- 4
p27$rate <- .065
p27$pv.div <- p27$dividend / (p27$rate / p27$m)
```

$$
\begin{aligned}
\text{PV}_{\text{dividend}} &= \frac{C_0}{r/m}\\\\
 &= \frac{\$`r pretty(p27$dividend)`}{`r p27$rate`/ `r p27$m`}\\
  &= \$`r pretty(p27$pv.div)`
\end{aligned}
$$

---

# 28. Annuity present values

What is the present value of an annuity of \$6,500 per year with the first cash
flow received three years from today and the last one received 25 years from
today? Use a discount rate of 7 percent.

---

```{r problem 28; setup, echo=F}
p28 <- new.env()
p28$cf <- 6500
p28$start <- 2
p28$end <- 25
p28$discount <- .07
p28$n.payments <- p28$end - p28$start
p28$pv.annuity <- p28$cf * (1 - (1 + p28$discount)^(-p28$n.payments)) /
  p28$discount
p28$pv.discounted <- p28$pv.annuity / (1 + p28$discount)^(p28$start)
```

The annuity begins to pay out three years from now and the last payment is 25
years from now. This means that there are $25 - 2 = 23$ payments.

Find the present value of the annuity:

$$
\begin{aligned}
\text{PV}_{\text{annuity}} &= C_0 \cdot
  \left[\frac{1 - (1 + r)^{-T}}{r}\right]\\\\
  &= \$`r pretty(p28$cf, 0)`
  \left[
    \frac{1 - (1 + `r p28$discount`)^{-`r p28$n.payments`}}{`r p28$discount`}
  \right]\\
  &= \$`r pretty(p28$pv.annuity)`
\end{aligned}
$$

Now date it back two years to date 0

$$
\begin{aligned}
\frac{\$`r pretty(p28$pv.annuity)`}{(1 + `r p28$discount`)^{`r p28$start`}}
  = \$`r pretty(p28$pv.discounted)`
\end{aligned}
$$

---

# 29. Annuity present values

What is the value today of a 15-year annuity that pays \$650 a year? The
annuity's first payment occurs six years from today. The annual interest rate is
11 percent for Years 1 through 5, and 13 percent thereafter.

---

```{r problem 29; setup, echo=F}
p29 <- new.env()
p29$pv.f <- function(cf, r, n) cf * sum((1 + r)^(-n))
p29$cf <- 650
# Discount rate during annuity payments
p29$r.1 <- .13
p29$n.1 <- 1:15
# Discount rate before annuity payments
p29$r.2 <- .11
p29$n.2 <- 5
p29$pv.annuity <- p29$cf * sum((1 + p29$r.1)^(-p29$n.1))
p29$pv.discounted <- p29$pv.annuity / (1 + p29$r.2)^(p29$n.2)
```

To find the value today of a 15 year annuity that pays \$650 per year, beginning
6 years from today, we need to do the following:

### Step 1: Understand the timing

* Payments: \$650 per year for 15 years, starting at year 6 through year 20.

* Interest rates: Years 1-5: 11\%, years 6-20: 13\%

### Step 2: Calculate the present value of the annuity at year 5

$$
\begin{aligned}
\text{PV}_{\text{annuity}} &= C \times
  \left[\frac{1 - (1 + r)^{-T}}{r}\right]\\\\
\text{PV}_{\text{annuity}} &= `r p29$cf` \times
  \left[\frac{1 - (1 + `r p29$r.1`)^{-`r tail(p29$n.1,1)`}}
  {`r p29$r.1`}\right]\\
  &= `r pretty(p29$pv.annuity)`
\end{aligned}
$$

### Step 3: Discount the annuity back to year 0 (today)

$$
\begin{aligned}
\text{PV}_{\text{at year 0}} &= \frac{\text{PV}_{\text{annuity}}}
  {(1 + r)^T}\\\\
  &= \frac{`r pretty(p29$pv.annuity)`}{(1 + `r p29$r.2`)^{`r p29$n.2`}}\\
  &= `r pretty(p29$pv.discounted)`
\end{aligned}
$$

---

# 30. Balloon payments

Audrey Sanborn has just arranged to purchase a \$550,000 vacation home in the
Bahamas with a 20 percent down payment. The mortgage has a 6.1 percent stated
annual interest rate, compounded monthly, and calls for equal monthly payments
over the next 30 years. Her first payment will be due one month from now.
However, the mortgage has an eight-year ballon payment, meaning that the balance
of the loan must be paid off at the end of Year 8. There were no other
transaction costs or finance charges. How much will Audrey's ballon payment be
in eight years?

---

```{r problem 30; setup, echo=F}
p30 <- new.env()
# Purchase minus 20 percent down payment
p30$mortgage = 550000 * .8
p30$apr = .061
p30$m = 12
p30$t = 30
p30$n = p30$m * p30$t
# Balloon payment is at the end of year 8.
p30$n.balloon = p30$n - p30$m * 8
p30$c = p30$mortgage / ((1 - (1 + p30$apr/p30$m)^(-p30$n)) / (p30$apr/p30$m))
p30$balloon = p30$c * (1 - (1 + p30$apr/p30$m)^(-p30$n.balloon)) /
  (p30$apr/p30$m)
```

### Step 1: Calculate the monthly payments

$$
\begin{aligned}
\text{PV}_{\text{mortgage}} &= C \frac{[1 - (1 + r/m)^{-mT}]}{r/m}\\\\
C &= \frac{\text{PV}_{\text{mortgage}}}{([1 - (1 + r/m)^{-mT}] / (r/m))}\\\\
C &= \frac{\$`r pretty(p30$mortgage)`}
  {[1 - (1 + `r p30$apr` / `r p30$m`)^{-`r p30$n`}] / (`r p30$apr` / `r p30$m`)}\\
  &= \$`r pretty(p30$c)`
\end{aligned}
$$

### Step 2: Calculate the balloon payment

Now, there is an easy and hard way to determine the balloon payment. The hard
way is to actually amortize the loan for `r p30$m * 8` months to see what the
balance is at that time. The easy way is to recognize that after `r p30$m * 8`
months, we have a `r p30$n.balloon`-month loan. The payment is
still \$`r pretty(p30$c)` per month, and the interest rate is
still `r percent(p30$apr/p30$m)` per month. The loan balance is thus the present
value of the remaining payments:

$$
\begin{aligned}
\text{Loan balance} & = \$`r pretty(p30$c)` \times
  \left[\frac{1 - (1 + (1 + `r p30$apr` / `r p30$m`)^{-`r p30$n.balloon`}}
  {`r p30$apr` / `r p30$m`}\right]\\\\
  &= \$`r pretty(p30$balloon)`
\end{aligned}
$$

Book: \$386,994.11

---

# 31. Calculating interest expense

You receive a credit card application from Shady Banks Savings and Loan offering
an introductory rate of 2.40 percent per year, compounded monthly for the first
six months, increasing thereafter to 18 percent compounded monthly. Assuming you
transfer the \$7,500 balance from your existing credit card and make no
subsequent payments, how much interest will you owe at the end of the first
year?

---

```{r problem 31; setup, echo=F}
p31 <- new.env()
p31$r.intro <- .024
p31$n <- 6
p31$m <- 12
p31$r <- .18
p31$c <- 7500
p31$balance.6m <- p31$c * (1 + p31$r.intro / p31$m)^p31$n
p31$balance.12m <- p31$balance.6m * (1 + p31$r / p31$m)^p31$n
p31$interest <- p31$balance.12m - p31$c
```

We compund the \$7,500 through two different monthly rates. For the first 6
months we compound at the rate of 2.4\% per year, and then for the next 6 months
we have:

First six months:

$$
\begin{aligned}
\text{Balance} &= \$`r pretty(p31$c, 0)` \times
  \left(1 + \frac{`r p31$r.intro`}{`r p31$m`} \right)^{`r p31$n`}\\
  &= \$`r pretty(p31$balance.6m)`
\end{aligned}
$$

We use the output from the first six months as the input of the next six months of the year:

$$
\begin{aligned}
\text{Total Balance} &= \$`r pretty(p31$balance.6m)` \times
  \left(1 + \frac{`r p31$r`}{`r p31$m`} \right)^{`r p31$n`}\\
  &= \$`r pretty(p31$balance.12m)`
\end{aligned}
$$

The interest paid is found by subtracting the principal from the total payment:

$$
\begin{aligned}
\text{Interest Paid} &= \$`r pretty(p31$balance.12m)` - \$`r pretty(p31$c, 0)`\\
  &= \$`r pretty(p31$interest)`
\end{aligned}
$$

---

# 32. Perpetuities

Barrett Pharmaceuticals is considering a drug project that costs \$2.5 million
today and is expected to generate end-of-year annual cash flows of \$227,000,
forever. At what discount rate would Barrett be indifferent between accepting or
rejecting the project?

---

```{r problem 32; setup, echo=F}
p32 <- new.env()
p32$investment <- 2.5e6
p32$cf <- 227000
p32$r <- p32$cf / p32$investment
```

Using the perpetuity equation we can find the rate:

$$
\begin{aligned}
\text{PV}_{\text{Perpetuity}} &= \frac{C}{r}\\\\
\$`r pretty(p32$investment, 0)`  &= \frac{\$`r pretty(p32$cf, 0)`}{r}\\\\
r &= \frac{\$`r pretty(p32$cf, 0)`}{\$`r pretty(p32$investment, 0)`}\\
  &= `r percent(p32$r)`
  \%
\end{aligned}
$$

---

# 33. Growing Annuity

Southern California Publishing Company is trying to decide whether to revise its
popular textbook, _Financial Psychoanalysis Made Simple_. The company has
estimated that the revision will cost \$75,000. Cash flows from increased sales
will be \$21,000 the first year. These cash flows will increase by 4 percent per
year. The book will go out of print five years from now. Assume that the initial
cost is paid now and revenues are received at the end of each year. If the
company requires a return of 10 percent for such an investment, should it
undertake the revision?

---

```{r problem 33; setup, echo=F}
p33 <- new.env()
p33$investment <- 75000
p33$cf <- 21000
p33$g <- .04
p33$n <- 5
p33$r <- .1
## If we wanted to calculate the present value incrementally we would use the
##  following. However, since the cash flows grow at a rate, we will use the
##  growth annuity formula.
#p33$pv <- p33$cf * sum((1 + p33$g)^(0:(p33$n-1)) /
#  (1 + p33$r)^(1:p33$n))
p33$pv <- p33$cf * ((1 - ((1 + p33$g) / (1 + p33$r))^p33$n) / (p33$r - p33$g))
p33$npv <- p33$pv - p33$investment
```

We need to find the net present value of revising and releasing the new edition
of the textbook.

We use the growth formula for an annuity. Which we derive below:

$$
\begin{aligned}
\text{PV}_{\text{annuity}} &= \text{CF} \times
  \sum^N_{n=1}{\frac{(1 + g)^{n-1}}{(1 + r)^{n}}}\\
  &= \text{CF} \times \left[\frac{1}{(1 + r)} + \frac{(1 + g)}{(1 + r)^2}
  + \frac{(1 + g)^2}{(1 + r)^3} + \cdots
  + \frac{(1 + g)^{n-1}}{(1 + r)^{n}}\right]\\\\
  &= \text{CF} \times \left[\frac{1 - \left(\frac{1 + g}{1 + r}\right)^N}
     {r - g}\right]\\
  &= \$`r pretty(p33$cf, 0)` \times
  \left[
    \frac{1 - \left(\frac{1 + `r p33$g`}{1 + `r p33$r`}\right)^{`r p33$n`}}
    {`r p33$r` - `r p33$g`}
  \right]\\
  &= \$`r pretty(p33$pv, 0)`
\end{aligned}
$$

We subtract the initial investment from the annuity to get the net present
value.

$$
\begin{aligned}
\text{NPV} &= \text{PV}_{\text{annuity}} - \text{Initial investment}\\
  &= \$`r pretty(p33$pv, 0)` - \$`r pretty(p33$investment, 0)`\\
  &= \$`r pretty(p33$npv, 0)`
\end{aligned}
$$

The net present value is \$`r pretty(p33$npv, 0)`. Since the value is positive,
we should undertake the revision.

---

# 34. Growing annuity

Your job pays you only once a year for all the work you did over the previous 12
months. Today, December 31, you just received your salary of \$65,000, and you
plan to spend all of it. However, you want to start saving for retirement
beginning next year. You have decided that one year from today you will begin
depositing 5 percent of your annual salary in an account that will earn 10
percent per year. Your salary will increase at 4 percent per year throughout
your career. How much money will you have on the date of your retirement 40
years from today?

---

```{r problem 34; setup, echo=F}
p34 = new.env()
p34$salary = 65000
p34$saving = p34$salary * .05
p34$r = .1
p34$g = .04
p34$n = 40
p34$fv = p34$saving * ((1 + p34$r)^p34$n - (1 + p34$g)^p34$n) /
  (p34$r - p34$g)
```

We are calculating the future value of a series of growing deposits into an
account that will earn interest of 10 percent a year.

### Step 1: Derive the future value formula from the annuity formula

We know the present value of a series of growing payments is:

$$
\text{PV} = C_0
  \left[\frac{1 - \left(\frac{(1 + g)}{(1 + r)}\right)^{t}}{r - g}\right]
$$

The future value is simply the present value times the compound interest:

$$
\text{FV} = \text{PV} (1 + r)^t
$$

Therefore, the formula for the future value of our account is:

$$
\begin{aligned}
\text{FV} &= C_0
  \left[\frac{1 - (\frac{(1 + g)^t}{(1 + r)^t}}{r - g}\right]
  (1 + r)^t\\
  &= C_0
  \left[\frac{(1 + r)^t - (1 + g)^t}{r - g}\right]
\end{aligned}
$$

### Step 2: Calculate the future value

The starting amount we are saving (which will grow at 4\%) is:

$$
\text{Saving} = \$`r pretty(p34$salary, 0)` \times .05
  = \$`r pretty(p34$saving, 0)`
$$

Now lets plug in the numbers:

$$
\begin{aligned}
\text{FV} &= \$`r pretty(p34$saving, 0)` \left[\frac{(1 + `r p34$r`)^{`r p34$n`}
  - (1 + `r p34$g`)^{`r p34$n`}}{`r p34$r` - `r p34$g`}\right]\\
  &= \$`r pretty(p34$fv, 0)`
\end{aligned}
$$

The value of the account at the time of retirement will be
\$`r pretty(p34$fv, 0)`.

Book: \$2,279,147

Error: `r percent((2279147 - p34$fv) / (2279147))`

---

# 35. Present value and interest rates

What is the relationship between the value of an annuity and the level of
interest rates? Suppose you just bought a 15-year annuity of \$6,800 per year at
the current interest rate of 10 percent per year. What happens to the value of
your investment if interest rates suddenly drop to 5 percent? What if interest
rates suddenly rise to 15 percent?

---

```{r problem 35; setup, echo=F}
p35 <- new.env()
p35$n <- 15
p35$c <- 6800
p35$r <- c(.1, .05, .15)
p35$pv <- p35$c * unlist(lapply( p35$r,
  function(r) sum((1 + r)^(-(1:p35$n)))))
```

An annuity is a series of payments over a set period of time. The effect of
interest rates on the value of those payments depends on its change. If interest
rates increase than the value of those payments decrease. If interest rates
decrease than the value of those payments increase. The following will
demonstrate this.

## The present value of an annuity

An annuity is a series of payments over a set period of time $t$:

$$
\begin{aligned}
\text{PV} &= \frac{C}{(1 + r)} + \frac{C}{(1 + r)^2} + \cdots
  + \frac{C}{(1 + r)^t} = C \sum^T_{t = 1} \frac{1}{(1 + r)^t}
\end{aligned}
$$

As $t$ increases, the term in the denominator $(1 + r)$ becomes more prominent
and begins to diminish the value of the cash flows. The interest rate $r$ also
has an effect. The larger the interest rate $r$, the more prominent the
denominator becomes, and the effects compound at the long end of this equation.

## Demonstration

Lets calculate the present value of a 15-year annuity paying \$6,800 a year at
an interest rate of 10 percent:

$$
\begin{aligned}
\text{PV} &= C \times \frac{1 - (1 + r)^{-T}}{r}\\\\
  &= \$`r pretty(p35$c, 0)` \left[\frac{1 - (1 + `r p35$r[1]`)^{`r p35$T`}}
  {`r p35$r[1]`}\right]\\
  &= \$`r pretty(p35$pv[1], 0)`
\end{aligned}
$$

With a 10 percent interest rate, the present value of the 15-year annuity is 
\$`r pretty(p35$pv[1], 0)`.

If the interst rate were to drop to 5 percent, then the value would be:

$$
\begin{aligned}
\text{PV} &= C \times \frac{1 - (1 + r)^{-T}}{r}\\\\
  &= \$`r pretty(p35$c, 0)` \left[\frac{1 - (1 + `r p35$r[2]`)^{`r p35$T`}}
  {`r p35$r[2]`}\right]\\
  &= \$`r pretty(p35$pv[2], 0)`
\end{aligned}
$$

This is an increase of \$`r pretty(p35$pv[2] - p35$pv[1], 0)`.

If the interest rate were to increase to 15 percent instead, then the value of
the 15-year annuity would be:

$$
\begin{aligned}
\text{PV} &= C \times \frac{1 - (1 + r)^{-T}}{r}\\\\
  &= \$`r pretty(p35$c, 0)` \left[\frac{1 - (1 + `r p35$r[3]`)^{`r p35$T`}}
  {`r p35$r[3]`}\right]\\
  &= \$`r pretty(p35$pv[3], 0)`
\end{aligned}
$$

This is a decrease of \$`r pretty(p35$pv[1] - p35$pv[3])`.

---

# 36. Calculating the number of payments

You're prepared to make monthly payments of \$350, beginning at the end of this
month, into an account that pays 10 percent interest compounded monthly. How
many payments will you have made when your account balance reaches \$35,000?

---

```{r problem 36; setup, echo=F}
p36 <- new.env()
p36$c <- 350
p36$r <- .1 / 12 # months
p36$fv <- 35000
p36$n <- log(p36$r * (p36$fv / p36$c) + 1) / log(1 + p36$r)
```

We need to derive the future value of an annuity to understand how many months
it will take to reach \$35,000.

The present value of an annuity is derived:

$$
\begin{aligned}
\text{PV} &= \frac{C}{(1 + r)} + \frac{C}{(1 + r)^2} + \cdots
  + \frac{C}{(1 + r)^n}\\\\
(1 + r) \cdot \text{PV} &= C + \frac{C}{(1 + r)}
  + \frac{C}{(1 + r)^2} + \cdots + \frac{C}{(1 + r)^{n-1}}\\\\
(1 + r) \cdot \text{PV} - \text{PV} &= C - \frac{C}{(1 + r)^n}\\\\
\text{PV} \cdot ((1 + r) - 1) &= C \cdot \left[1 - \frac{1}{(1 + r)^n}\right]\\\\
\text{PV} &= C \cdot \left[\frac{1 - (1 + r)^{-n}}{r}\right]
\end{aligned}
$$

The future value is the present value times the compounding interest:

$$
\begin{aligned}
\text{FV} &= \text{PV} \cdot (1 + r)^n\\
  &= C \cdot \left[\frac{1 - (1 + r)^{-n}}{r}\right] \cdot (1 + r)^n\\\\
\text{FV} &= C \cdot \left[\frac{(1 + r)^n - 1}{r}\right]
\end{aligned}
$$

Now we need to solve for the number of months $n$. Keep in mind that $r$ is the
APR and needs to be divided by 12, the number of months in a year.

$$
\begin{aligned}
\frac{\text{FV}}{C} &= \frac{(1 + r)^n + 1}{r}\\\\
r \cdot \frac{\text{FV}}{C} - 1 &= (1 + r)^n\\\\
\ln{\left(r \cdot \frac{\text{FV}}{C} - 1\right)} &= n \ln{(1 + r)}\\\\
n &= \frac{\ln{\left(r \cdot \frac{\text{FV}}{C} - 1\right)}}
  {\ln{(1 + r)}}\\\\
  &= \frac{\ln{\left(`r p36$r`
  \cdot \frac{`r pretty(p36$fv)`}{`r pretty(p36$c)`} - 1\right)}}
  {\ln{(1 + `r p36$r`)}}\\
  &= `r round(p36$n)`
\end{aligned}
$$

Using `R`s `uniroot` function we can also determine $n$

```{r problem 36; show uniroot solution, echo=T}
p36$f <- function(n) p36$c * ((1 + p36$r)^n - 1) / p36$r - p36$fv
uniroot(p36$f, upper=1000, lower=10, tol=.01)$root
```

Here `p36$c`, `p36$r`, and `p36$fv` have already been defined as:
`r pretty(p36$c, 0)`, `r p36$r` (.1 / 12), and `r pretty(p36$fv, 0)`
respectively.

---

# 37. Calculating annuity present values

You want to borrow \$65,000 from your local bank to buy a new sailboat. You can
afford to make monthly payments of \$1,320, but no more. Assuming monthly
compounding, what is the highest APR you can afford on a 60-month loan?

---

```{r problem 37; setup, echo=F}
p37 <- new.env()
```

We are borrowing \$65,000 from the bank for a period of 60-months and will be
making payments of \$1,320. That means we find the APR rate $r$ that satisfies:

$$
\text{PV} = C \times \sum^{60}_{n=1}{\frac{1}{(1 + r/m)^{-n}}}
$$

Where $m$ is the number of months in a year (12) and $C$ is the monthly payments.

The best way to solve this is using `R`s `uniroot` function:

```{r problem 37; show uniroot solution, echo=T}
p37$pv <- 65000
p37$c <- 1320
p37$n <- 60
p37$f <- function(r) p37$c * sum((1 + r/12)^(-(1:p37$n))) - p37$pv
percent(p37$apr <- uniroot(p37$f, upper=1, lower=1e-4, tol=1e-8)$root)
percent(p37$ear <- (1 + p37$apr / 12)^(12) - 1)
```

The highest APR is `r percent(p37$apr)`.

---

# 38. Calculating loan payments

You need a 30-year, fixed-rate mortgage to buy a new home for \$250,000. Your
mortgage bank will lend you the money at a 5.3 percent APR for this 360-month
loan. However, you can only afford monthly payments of \$950, so you offer to
pay off any remaining loan balance at the end of the loan in the form of a
single balloon payment. How large will this balloon payment have to be for you
to keep your monthly payment at \$950?

---

```{r problem 38; setup, echo=F}
p38 <- new.env()
p38$pv <- 250000
p38$r <- .053 / 12 # Monthly
p38$t <- 360
p38$c <- 950
p38$fv <- p38$pv * (1 + p38$r)^p38$t
p38$fv.payments <- p38$c * ((1 + p38$r)^p38$t - 1) / p38$r
p38$balloon <- p38$fv - p38$fv.payments
```

We want to find out what the final balloon payment will be if we want to limit
our payments to \$950 a month for the entire term of the loan.

## Step 1: Calculate the future value of the loan

$$
\begin{aligned}
\text{FV} &= C \cdot \left[\frac{(1 + r)^t - 1}{r}\right]\\
  &= \$`r pretty(p38$pv, 0)` \cdot
  \left[\frac{(1 + `r p38$r`)^{`r p38$t`} - 1}{`r p38$r`}\right]\\
  &= \$`r pretty(p38$fv, 0)`
\end{aligned}
$$

## Step 2: Calculate the future value of the loan using \$950 as payments

$$
\begin{aligned}
\text{FV} &= \$`r pretty(p38$c)` \cdot
  \left[\frac{(1 + `r p38$r`)^{`r p38$t`} - 1}{`r p38$r`}\right]\\
  &= `r pretty(p38$fv.payments, 0)`
\end{aligned}
$$

## Step 3: The monthly payments will be paid for 30 years

The amount of the loan remaining:

$$
\begin{aligned}
\text{Balloon} &= \text{FV}_{\text{loan}} - \text{FV}_{\text{payments}}\\
  &= `r pretty(p38$fv)` - `r pretty(p38$fv.payments)`\\
  &= `r pretty(p38$balloon)`
\end{aligned}
$$

Book: \$385,664.73

---

# 39. Present and future values

The present value of the following cash flow stream is \$7,300 when discounted
at 8 percent annually. What is the value of the missing cash flow?

```{r problem 39; table, echo=F}
p39 <- new.env()
p39$year <- c(1,2,3,4)
p39$cash.flow <- c(1500, NA, 2700, 2900)
p39$pv <- 7300
p39$r <- .08
p39$calcs <- p39$cash.flow / (1 + p39$r)^(p39$year)
p39$sum.calcs <- sum(p39$calcs, na.rm=T)
p39$c.2 <- (p39$pv - p39$sum.calcs) * (1 + p39$r)^2
knitr::kable(data.frame(year=p39$year, cash.flow=p39$cash.flow))
p39$check.cash.flow <- c(1500, p39$c.2, 2700, 2900)
p39$check <- sum(p39$check.cash.flow * (1 + p39$r)^(-p39$year))
```

---

We need to find the missing cash flow given the present value and the discount
rate.

We know the structure of the series, therefore we can find $C_2$:

$$
\begin{aligned}
\text{PV} &= \frac{C_{1}}{1 + r} + \frac{C_{2}}{(1 + r)^{2}} +
  \frac{C_{3}}{(1 + r)^3} + \frac{C_{4}}{(1 + r)^4}\\\\
`r pretty(p39$pv, 0)` &=
    \frac{`r pretty(p39$cash.flow[1], 0)`}{(1 + `r p39$r`)^{`r p39$year[1]`}}
  + \frac{`r pretty(p39$cash.flow[2], 0)`}{(1 + `r p39$r`)^{`r p39$year[2]`}}
  + \frac{`r pretty(p39$cash.flow[3], 0)`}{(1 + `r p39$r`)^{`r p39$year[3]`}}
  + \frac{`r pretty(p39$cash.flow[4], 0)`}{(1 + `r p39$r`)^{`r p39$year[4]`}}\\\\
`r pretty(p39$pv, 0)` &=
    `r pretty(p39$calcs[1], 0)`
  + `r pretty(p39$calcs[2], 0)`
  + `r pretty(p39$calcs[3], 0)`
  + `r pretty(p39$calcs[4], 0)`\\
C_2 &= `r pretty(p39$c.2)`
\end{aligned}
$$

---

# 40. Calculating present values

You just won the TVM Lottery. You will receive \$1 million today plus another 10
annual payments that increase by \$275,000 per year. Thus, in one year you
receive \$1.275 million. In two years, you get \$1.55 million, and so on. If
the appropriate interest rate is 9 percent, what is the present value of your
winnings?

---

```{r problem 40; setup, echo=F}
p40 <- new.env()
p40$c.0 <- 1e6
p40$inc <- 275000
p40$r <- .09
p40$t <- 0:10
p40$g <- p40$inc / p40$c.0
p40$pv <- sum((p40$c.0 + p40$inc*p40$t) / (1 + p40$r)^(p40$t))
```

We need to calculate the value of a growing annuity. However the growth rate
of `r percent(p40$g)` is far larger than the interest rate of 9\%. This means we
cannot use the annuity formula and must calculate the 10 annual payments
manually.

The annuity is as follows:

$$
\begin{aligned}
\text{PV} &= 1 + \frac{1.275}{(1 + .09)} + \frac{1.55}{(1 + .09)^2} + \cdots
  + \frac{1 + .275 \cdot n}{(1 + .09)^n}\\\\
  &= \sum_{n=0}^{10}{\frac{1 + .275 \cdot n}{(1 + .09)^n}}\\
  &= `r pretty(p40$pv, 0)`
\end{aligned}
$$

The present value of the winnings is \$`r pretty(p40$pv, 0)`.

---

# 41. EAR versus APR

You have just purchased a new warehouse. To finance the purchase, you've
arranged for a 30-year mortgage for 80 percent of the \$4,500,000 purchase price.
The monthly payment on this loan will be \$27,500. What is the APR on this loan?
The EAR?

---

```{r problem 41; setup, echo=F}
p41 <- new.env()
p41$t <- 30 * 12
p41$pv <- 4500000 * .8
p41$c <- 27500
```

The amount of the loan is 80 percent of the warehouse purchase price:

$$
\text{Loan} = \$4,500,000 \times .80 = \$`r pretty(p41$pv)`\\
$$

The present value of the loan is equal to the sum of all the monthly payments:

$$
\begin{aligned}
\text{PV} &= \sum^{T}_{t = 1}{\frac{C}{(1 + r)^t}}\\
`r pretty(p41$pv, 0)`  &= \sum^{`r p41$t`}_{t = 1}
  {\frac{`r pretty(p41$c, 0)`}{(1 + r)^t}}\\
0 &= \sum^{`r p41$t`}_{t = 1}{\frac{`r pretty(p41$c, 0)`}{(1 + r)^t}}
  - `r pretty(p41$pv, 0)`
\end{aligned}
$$

We can use `R`s `uniroot` function to find the EAR, and multiply it by 12 months
to find the APR:

```{r problem 41; show uniroot, echo=T}
p41$t <- 30 * 12
p41$pv <- 4500000 * .8
p41$c <- 27500
p41$f <- function(r) p41$c * sum((1 + r/12)^(-(1:p41$t))) - p41$pv
percent(p41$apr <- uniroot(p41$f, lower=1e-5, upper=10, tol=1e-8)$root)
percent(p41$ear <- (1 + p41$apr/12)^12 - 1)
```

The APR is $r \times 12 = 8.429$%. The EAR is:

$$
\begin{aligned}
\mathbf{EAR} &= (1 + r)^{12} - 1 \\
 &= 8.762\%
\end{aligned}
$$

---

# 42. Present value and break-even interest

Consider a firm with a contract to sell an asset for \$115,000 three years from
now. The asset costs \$76,000 to produce today. Given a relevant discount rate
on this asset of 13 percent per year, will the firm make a profit on this asset?
At what rate does the firm just break even?

---

```{r problem 42; setup, echo=F}
p42 <- new.env()
p42$pv <- 76000
p42$fv <- 115000
p42$r <- .13
p42$t <- 3
p42$npv <- p42$fv / (1 + p42$r)^(p42$t) - p42$pv
p42$f <- function(r) p42$fv / (1 + r)^(p42$t) - p42$pv
p42$r.break.even <- uniroot(p42$f, upper=1, lower=1e-5, tol=1e-8)$root
```

## Profit

To find if the firm will make a profit, calculate the present value of \$115,000
to find if it is greater than \$76,000.

$$
\begin{aligned}
\text{PV} &= \frac{\$`r pretty(p42$fv)`}{(1 + `r p42$r`)^{`r p42$t`}}\\\\
 &= \$`r pretty(p42$npv, 2)`
\end{aligned}
$$

So the firm will make a profit of \$`r pretty(p42$npv)`.

## Break even

The break even interest rate is the rate where:

$$
\begin{aligned}
\$`r pretty(p42$pv)` &= \frac{\$`r pretty(p42$fv)`}{(1 + r)^{`r p42$t`}}
\end{aligned}
$$

Using `R`s `uniroot` function we find $r$ as `r percent(p42$r.break.even)`.

Book: \$3,700.77; 14.81\%

---

# 43. Present value and multiple cash flows

What is the present value of \$5,000 per year, at a discount rate of 6 percent,
if the first payment is received 6 years from now and the last payment is
received 25 years from now?

---

```{r problem 43; setup, echo=F}
p43 <- new.env()
p43$c <- 5000
p43$r <- .06
p43$start <- 6
p43$end <- 25
p43$t <- p43$end - p43$start + 1
p43$pv.1 <- p43$c * (1 - (1 + p43$r)^(-p43$t)) / p43$r
p43$pv <- p43$c * sum((1 + p43$r)^(-(p43$start:p43$end)))
```

First calculate the present value of the payments for $5 - 25 = 20$ years.


$$
\begin{aligned}
\text{PV}_{\text{6 years from now}} &=
  \sum_{n=0}^{`r p43$t`}{\frac{`r pretty(p43$c)`}{(1 + `r p43$r`)^{n}}}\\\\
  &= `r pretty(p43$c, 0)` \cdot \frac{1 - (1 + `r p43$r`)^{-20}}{`r p43$r`}\\\\
  &= `r pretty(p43$pv.1)`
\end{aligned}
$$

Now we project this back six years to find its present value today:

$$
\begin{aligned}
\mathbf{PV}_{\text{today}} &= \frac{`r pretty(p43$pv.1)`}
  {(1 + `r p43$r`)^{`r p43$start - 1`}}\\\\
  &= `r pretty(p43$pv)`
\end{aligned}
$$

---

# 44. Variable interest rates

A 15-year annuity pays \$1,500 per month, and payments are made at the end of
each month. If the interest rate is 12 percent compounded monthly for the first
seven years, and 6 percent compounded monthly thereafter, what is the present
value of the annuity?

---

```{r problem 44; setup, echo=F}
p44 <- new.env()
p44$t <- c(7, 15 - 7) * 12
p44$c <- 1500
p44$r <- c(.12, .06) / 12
p44$pv.f <- function(c, r, t) c * sum((1 + r)^(-(1:t)))
p44$pv.1 <- p44$pv.f(p44$c, p44$r[1], p44$t[1])
p44$pv.2 <- p44$pv.f(p44$c, p44$r[2], p44$t[2])
p44$pv.2.discounted <- p44$pv.2 * (1 + p44$r[1])^(-p44$t[1])
p44$pv <- p44$pv.1 + p44$pv.2.discounted
```

---

The given information can be restated as:

$$
\begin{aligned}
r_1 &= \frac{.12}{12} &= .01\\\\
r_2 &= \frac{.06}{12} &= .005\\\\
T_1 &= 12 \times 7 &= 84\\\\
T_2 &= 12 \times 8 &= 96\\\\
C_0 &= 1,500
\end{aligned}
$$

We need to solve for an annuity that pays the same but the interest rate changes
in the middile of the annuity cash flows.

$$
\begin{aligned}
\mathbf{PV}_{\text{annuity}} &= C_0 \times \frac{1 - (1 + r)^{-T}}{r}
\end{aligned}
$$

## Step 1: Calculate the two components of the annuity

$$
\begin{aligned}
\text{PV}_{1} &=
  `r pretty(p44$c)` \cdot \frac{1 - (1 + `r p44$r[1]`)^{-`r p44$t[1]`}}
  {`r p44$r[1]`}\\
  &= `r pretty(p44$pv.1)`\\\\
\text{PV}_{2} &=
  `r pretty(p44$c)` \cdot \frac{1 - (1 + `r p44$r[2]`)^{-`r p44$t[2]`}}
  {`r p44$r[2]`}\\
  &= `r pretty(p44$pv.2)`
\end{aligned}
$$

## Step 2: Project the second annuity back to the present day

We need to use the current interest rate (not the future rate that is used in
calculating the second component of the annuity) when projecting the value back
to the present day.

$$
\begin{aligned}
\text{PV}_{\text{today}} &= \frac{`r pretty(p44$pv.2)`}
  {(1 + `r p44$r[1]`)^{`r p44$t[1]`}}\\\\
  &= `r pretty(p44$pv.2.discounted)`
\end{aligned}
$$

The present value of the annuity is the sum of the two annuity components.

$$
  `r pretty(p44$pv.1)` + `r pretty(p44$pv.2.discounted)` = `r pretty(p44$pv)`
$$


Book: \$134,455.36

---

# 45. Comparing cash flow streams

You have your choice of two investment accounts. Investment A is a 15-year
annuity that features end-of-month \$1,500 payments and has an interest rate
of 8.7 percent compounded monthly. Investment B is an 8 percent continuously
compounded lump-sum investment, also good for 15 years. How much money would you
need to invest in B today for it to be worth as much as Investment A 15 years
from now.

---

```{r problem 45; setup, echo=F}
p45 <- new.env()
p45$t <- 15
p45$m <- 12
p45$n.1 <- p45$t * p45$m
p45$r <- c(.087, .08)
p45$rm <- p45$r / p45$m
p45$c.A <- 1500
# We calculate from 0 to n-1 power series
p45$fv.A <- sum(p45$c.A * (1 + p45$rm[1])^((0:(p45$n.1-1))))
p45$c.B <- p45$fv.A / exp(p45$r[2] * p45$t)
```

## Step 1: Calculate the present value of investment A

$$
\begin{aligned}
\text{FV}_{\text{A}} &= \$`r pretty(p45$c.A, 0)` \times
  \frac{1 - (1 + \frac{`r p45$r[1]`}{12})^{`r p45$n.1`}}{\frac{`r p45$r[1]`}{12}}\\\\
  &= \$`r pretty(p45$fv.A)`
\end{aligned}
$$

## Step 2: Find the initial investment for B

$$
\begin{aligned}
\text{FV}_{\text{B}} &= C_B \times e^{rt}\\\\
\$`r pretty(p45$fv.A, 0)` &= C_B e^{`r p45$r[2]` \times `r p45$t`}\\\\
C_B &= \frac{`r pretty(p45$fv.A, 0)`}{e^{`r p45$r[2] * p45$t`}}\\
  &= \$`r pretty(p45$c.B, 0)`
\end{aligned}
$$

---

# 46. Calculating present value of a perpetuity

Given an interest rate of 6.1 percent per year, what is the value at Date
$t = 7$ of a perpetual stream of \$2,500 annual payments that begins at Date
$t = 15$?

---

```{r problem 46; setup, echo=F}
p46 <- new.env()
p46$c <- 2500
p46$n <- c(7, 15)
p46$t <- diff(p46$n)
p46$r <- .061
p46$pv.perpetuity <- p46$c / p46$r
p46$pv.at.7 <- p46$pv.perpetuity / (1 + p46$r)^(p46$t-1)
```

So we can pretend that $t = 7$ is the present. Therefore, We find the present
value of a perpetuity that begins $15 - 7 = 8$ years from now.

$$
\begin{aligned}
\text{PV} &= \frac{C}{r}\\\\
\text{PV} &= \frac{\$`r pretty(p46$c, 0)`}{`r p46$r`}\\
  &= \$`r pretty(p46$pv.perpetuity, 0)`
\end{aligned}
$$

We now project back 8 years:

$$
\begin{aligned}
\text{PV}_{\text{8 years previous}} &= \frac{\$`r pretty(p46$pv.perpetuity)`}
  {(1 + `r p46$r`)^{`r p46$t-1`}}\\
  &= \$`r pretty(p46$pv.at.7, 0)`
\end{aligned}
$$

---

# 47. Calculating EAR

A local finance company quotes a 16 percent interest rate on one-year loans. So,
if you borrow \$26,000, the interest for the year will be \$4,160. Because you
must repay a total of \$30,160 in one year, the finance company requires you to
pay \$30,160/12, or \$2,513.33, per month over the next 12 months. Is this a 15
percent loan? What rate would legally have to be quoted? What is the effective
annual rate?

---

```{r problem 47; setup, echo=F}
p47 <- new.env()
p47$pmt <- 2513.33
p47$PV <- 26000
p47$n <- 12
```

The loan involves equal monthly payments of \$2,513.33 for 12 months.

$$
\begin{aligned}
\text{P} &= C \times \frac{1 - (1 + r)^{-n}}{n}
\end{aligned}
$$

$$
\begin{aligned}
\text{PMT} &= 2,513.33 \\
\text{P} &= 26,000 \\
\text{n} &= 12
\end{aligned}
$$

Using R we can solve for `r`:

```{r problem 47; uniroot solution, echo=T}
f <- function(r) p47$pmt * (1 - (1 + r)^(-p47$n)) / r - p47$PV
(p47$r <- uniroot(f, lower=.001, upper=1, tol=1e-4)$root)
(p47$apr <- p47$r * 12)
(p47$ear <- (1 + p47$apr / p47$n) ^ (p47$n) - 1)
```

The monthly interest is `r percent(p47$r)`.

The APR is: `r percent(p47$r)` $\times 12 =$ `r percent(p47$apr)`.

The EAR is:
  $(1 + \frac{`r round(p47$apr, 2)`}{`r p47$n`})^{`r p47$n`} - 1 =$
  `r percent(p47$ear)`

Thus, this is not a 15% loan it is significantly higher. The finance company
would have to legally quote the __APR__ as `r percent(p47$apr)`, reflecting the cost based on
monthly compounding.

The __EAR__ of `r percent(p47$ear)` accounts for the full compounding effect over the year.

---

# 48. Calculating present values

A 5-year annuity of ten \$5,300 semiannual payments will begin 9 years from now,
with the first payment coming 9.5 years from now. If the discount rate is 12
percent compounded monthly, what is the value of this annuity five years from
now? What is the value three years from now? What is the current value of the
annuity?

---

```{r problem 48; setup, echo=F}
p48 <- new.env()
p48$c <- 5300
p48$t <- 5
p48$n <- 2
p48$tn <- 5 * 2
p48$r <- .12
p48$m <- 12
p48$rm <- p48$r / p48$m
p48$ear <- (1 + p48$rm)^6 - 1
p48$n.discount <- (9 - c(5, 3, 0))*p48$m
p48$pv.9y <- p48$c * sum((1 + p48$ear)^(-(1:p48$tn)))
p48$pv.discount <- p48$pv.9y / (1 + p48$rm)^(p48$n.discount)
```

This is a time value of money problem that involves a deferred annuity with
semiannual payments and monthly compounding.

## Step 1: Given data

* Payment: \$`r pretty(p48$c, 0)`

* Number of payments: `r p48$tn` (over `r p48$t` years, semiannual payments)

* First payment is 9.5 years from now.

* Discount rate is `r percent(p48$r)` compounded monthly. The monthly rate is
  `r p48$r` / `r p48$m` = `r p48$rm` per month.

## Step 2: Compute the PV of the Annuity at its starting point

$$
\begin{aligned}
\text{r} &= (1 + `r p48$r`)^6 -1 = `r p48$ear`\\
\text{PV}_9 &=
  `r pretty(p48$c, 0)` \times \frac{1 - (1 + `r round(p48$ear, 3)`)^{-`r p48$tn`}}
  {`r round(p48$ear, 3)`}\\
  &= `r pretty(p48$pv.9y)`\\\\
\end{aligned}
$$

## Step 3: Discount the annuity from 9 to 5, 3, and to the present:

$$
\begin{aligned}
\text{PV}_5 &= \frac{`r pretty(p48$pv.9y, 0)`}
  {(1 + `r p48$rm`)^{`r p48$n.discount[1]`}}\\
  &= `r pretty(p48$pv.discount[1], 0)`\\\\
\text{PV}_3 &= \frac{`r pretty(p48$pv.9y, 0)`}
  {(1 + `r p48$rm`)^{`r p48$n.discount[2]`}}\\
  &= `r pretty(p48$pv.discount[2], 0)`\\\\
\text{PV}_0 &= \frac{`r pretty(p48$pv.9y, 0)`}
  {(1 + `r p48$rm`)^{`r p48$n.discount[3]`}}\\
  &= `r pretty(p48$pv.discount[3], 0)`
\end{aligned}
$$

---

# 49. Calculating annuities due

Suppose you are going to receive \$20,000 per year for five years. The
appropriate interest rate is 7 percent.

a. What is the present value of the payments if they are in the form of an
ordinary annuity? What is the present value if the payments are an annuity due?

b. Suppose you plan to invest the payments for five years. What is the future
value if the payments are an ordinary annuity? What if the payments are an
annuity due?

c. Which has the highest present value, the ordinary annuity or annuity due?
Which has the highest future value? Will this always be true?

---

```{r problem 49; setup, echo=F}
p49 <- new.env()
p49$c <- 20000
p49$t <- 5
p49$r <- .07
p49$pv.a <- p49$c * sum((1 + p49$r)^(-(1:p49$t)))
p49$pv.due.a <- p49$c * sum((1 + p49$r)^(-(0:p49$t)))
p49$fv.b <- p49$c * sum((1 + p49$r)^(1:p49$t-1))
p49$fv.due.b <- p49$c * sum((1 + p49$r)^(1:p49$t))
```

## A. Present value

### Annuity in arrears

An ordinary annuity assumes that the first annuity payment begins a full period
hence.

$$
\begin{aligned}
\text{PV}_{\text{ordinary}}
  &= C \times \left(\frac{1 - (1 + r)^{-T}}{r}\right)\\\\
  &= \$`r pretty(p49$c, 0)` \times \left(\frac{1 - (1 + `r p49$r`)^{-`r p49$t`}}
      {`r p49$r`}\right)\\
  &= \$`r pretty(p49$pv.a, 0)`
\end{aligned}
$$

### Annuity due

An annuity due starts at date 0. Thus:

$$
\begin{aligned}
\text{PV}_{\text{due}} &= C + C \left(\frac{1 - (1 + r)^{-T}}
  {r}\right)\\\\
  &= \$`r pretty(p49$c, 0)` + \$`r pretty(p49$c, 0)`
  \times \left(\frac{1 - (1 + `r p49$r`)^{-`r p49$t`}}{`r p49$r`}\right)\\
  &= \$`r pretty(p49$pv.due.a)`
\end{aligned}
$$

## B. Future value

### Ordinary annuity

$$
\begin{aligned}
\text{FV}_{\text{ordinary}} &= C \times \left(\frac{(1 + r)^T - 1}{r}\right)\\\\
  &= \$`r pretty(p49$c, 0)` \left(\frac{(1 + `r p49$r`)^{-`r p49$t`} - 1}
  {`r p49$r`}\right)\\
  &= \$`r pretty(p49$fv.b, 0)`
\end{aligned}
$$

### Annuity due

$$
\begin{aligned}
\text{FV}_{\text{due}} &= C \times \left(\frac{(1 + r)^T - 1}{r}\right)
  \times (1 + r)\\\\
  &= \$`r pretty(p49$c, 0)` \times \left(\frac{(1 + `r p49$r`)^{`r p49$t`} - 1}
  {`r p49$r`}\right) \times (1 + `r p49$r`)\\
  &= \$`r pretty(p49$fv.due.b, 0)`
\end{aligned}
$$

## C.

For both the __present value__ and the __future value__ have a higher value because of the earlier payment. In the future value it has an additional period to earn interest.

---

# 50. Calculating annuities due

You want to buy a new sports car from Muscle Motors for \$73,000. The contract
is in the form of a 60-month annuity due at a 6.45 percent APR. What will your
monthly payment be?

---

```{r problem 50; setup, echo=F}
p50 <- new.env()
p50$pv <- 73000
p50$t <- 60
p50$apr <- .0645
p50$m <- 12
p50$r <- p50$apr / p50$m
p50$c <- p50$pv * (p50$r) / (1 - (1 + p50$r)^(-p50$t)) * (1 + p50$r)
```

## Given

* Price of the car (Present value): \$73,000

* Loan terms: 60 months

* APR = `r percent(p50$apr)` comounded monthly

* Payments are made at the beginning of each month $\rightarrow$ Annuity due.

## Calculate the monthly rate:

$$
\begin{aligned}
\text{r} &= \frac{\text{APR}}{m}\\
  &= \frac{`r p50$apr`}{`r p50$m`}\\
  &= `r p50$r`\\\\
\end{aligned}
$$

## Calculate the annuity due

$$
\begin{aligned}
\text{C} &= \$`r pretty(p50$pv, 0)` \times \frac{`r p50$r`}
  {1 - (1 + `r p50$r`)^{-`r p50$t`}} \times (1 + `r p50$r`)\\
  &= \$`r pretty(p50$c, 0)`
\end{aligned}
$$

---

# 51. Calculating annuities due

You want to lease a set of golf clubs from Pings Ltd. The lease contract is in
the form of 24 equal monthly payments at a 10.4 percent stated annual interest
rate, compounded monthly. Because the clubs cost \$2,300 retail, Pings wants the
PV of the lease payments to equal \$2,300. Suppose that your first payment is
due immediately. What will your monthly lease payments be?

---

```{r problem 51; setup, echo=F}
p51 <- new.env()
p51$pv <- 2300
p51$apr <- .104
p51$t <- 24
p51$m <- 12
p51$r <- p51$apr / p51$m
p51$c <- p51$pv * (p51$r / (p51$r + 1 - (1 + p51$r)^(-p51$t)))
p51$r.display <- round(p51$r, 5)
```

## Step 1: Calculate `r`

$$
r = \frac{\text{APR}}{m} = \frac{`r p51$apr`}{`r p51$m`} = `r p51$r.display`
$$

## Step 2: Calculate the annuity due

$$
\begin{aligned}
\text{PV} &= C  + C \times \left(\frac{1 - (1 + r)^{-T}}{r}\right)\\\\
\text{PV} &= C \times \left[1 + \left(
  \frac{1 - (1 + r)^{-T}}{r}\right)\right]\\\\
C &= \text{PV} \times \frac{1}{1 + \left(\frac{1 - (1 + r)^{-T}}{r}\right)}\\\\
C &= \text{PV} \times \frac{r}{r + 1 - (1 + r)^{-T}}\\
  &= \$`r pretty(p51$pv, 0)` \times \frac{`r p51$r.display`}
  {`r p51$r.display` + 1 - (1 + `r p51$r.display`)^(-`r p51$t`)}\\
  &= \$`r pretty(p51$c, 2)`
\end{aligned}
$$

---

# 52. Annuities

You are saving for the college education of your two children. They are two
years apart in age; one will begin college 15 years from today and the other
will begin 17 years from today. You estimate your children's college expenses to
be \$45,000 per year per child, payable at the beginning of each school year.
The annual interest rate is 7.5 percent. How much money must you deposit in an
account each year to fund your children's education? Your deposits begin one
year from today. You will make your last deposit when your oldest child enters
college. Assume four years of college.

---

```{r problem 52 annuities; setup, echo=F}
p52 <- new.env()

# Yearly college tuition.
p52$college.tuition <- 45000

# annual interest rate.
p52$r <- .075

# number of years in college.
p52$n.college <- 4

# child one starts college in 15 years.
p52$n.1 <- 15

# child two starts college in 17 years.
p52$n.2 <- 17

# The annuity factor.
p52$pvia <- function(r, t) sum((1 + r)^(-(1:t)))

# We begin payments as soon as the child begins college. This is an
# annuity due, therefore we calculate the annuity factor with one less year.
p52$pv.annuity.due <- p52$college.tuition *
    (1 + p52$pvia(p52$r, (p52$n.college - 1)))

# Present value of the payments today for child one.
p52$pv.1 <- p52$pv.annuity.due / (1 + p52$r)^(p52$n.1)

# Present value of the payments today for child two.
p52$pv.2 <- p52$pv.annuity.due / (1 + p52$r)^(p52$n.2)

# The total price to send both children to college.
p52$pv.total <- p52$pv.1 + p52$pv.2

# Caluclate the payments via `uniroot`.
p52$pv <- function(a) a * p52$pvia(p52$r, p52$n.1) - p52$pv.total
p52$yearly.deposits <- uniroot(p52$pv, upper=40000, lower=100, tol=10)$root
```

We are asked to compute equal annual deposits to fund two children's college
expenses, considering:

* Each child will need \$45,000 per year, for 4 years of college.

* Payments are made at the beginning of each college year (so these are annuity
  due payments).

* The first child begins in 15 years, the second child in 17 years.

* Annual interest rate is 7.5\%.

* You will make equal deposits each year starting one year from today, and the
  last deposit is when the first child starts college (year 15).

## Step 1: Determine present value (PV) of college expenses

We will compute the present value at time 0 of all the future college payments,
tehn solve for the annual deposit required to reach that amount.

For each child, the annuity due calculation will be the same. For the annuity
due payments, the first payment is due at the beginning of the first year. Then
we discound the following three years.

$$
\begin{aligned}
\text{PV Annuity Due} &= \$`r pretty(p52$college.tuition)` \times
    \left( 1 + \left[\frac{1 - (1 + `r p52$r`)^{-`r (p52$n.college - 1)`}}
    {`r p52$r`} \right] \right)\\
    &= \$`r pretty(p52$pv.annuity.due)`
\end{aligned}
$$

### Child 1 starts in year 15

$$
\begin{aligned}
\text{PV}_{\text{Child 1}} &= \frac{\$`r pretty(p52$pv.annuity.due)`}
    {(1 + `r p52$r`)^{`r p52$n.1`}}\\
    &= \$`r pretty(p52$pv.1)`
\end{aligned}
$$

### Child 2 starts in year 17

$$
\begin{aligned}
\text{PV}_{\text{Child 2}} &= \frac{\$`r pretty(p52$pv.annuity.due)`}
    {(1 + `r p52$r`)^{`r p52$n.2`}}\\
    &= \$`r pretty(p52$pv.2)`
\end{aligned}
$$

### Total present value of sending both children to college

$$
\begin{aligned}
\text{PV}_{\text{College}} &= \$`r pretty(p52$pv.1)` + \$`r pretty(p52$pv.2)`\\
    \$`r pretty(p52$pv.total)`
\end{aligned}
$$

### The payments, starting next year, will be

$$
\begin{aligned}
\text{PV} &= C \times \left[\frac{1 - (1 + r)^{-n}}{r}\right]\\\\
C &= \frac{\text{PV}}{\left[\frac{1 - (1 + r)^{-n}}{r}\right]}\\\\
  &= \frac{\$`r pretty(p52$pv.total)`}
  {\left[\frac{1 - (1 + `r p52$r`)^{-`r p52$n.1`}}{`r p52$r`}\right]}\\
  &= \$`r pretty(p52$yearly.deposits)`
\end{aligned}
$$

We will need to make payments of \$`r pretty(p52$yearly.deposits)` each year for
15 years to save enough to send the two children to college.

Book: \$11,571.48

---

# 53. Growing Annuities

Tom Adams has received a job offer from a large investment bank as a clerk to an
associate banker. His base salary will be \$55,000. He will receive his first
annual salary payment one year from the day he begins to work. In addition, he
will get an immediate \$10,000 bonus for joining the company. His salary will
grow at 3.5 percent each year. Each year he will receive a bonus equal to 10
percent of his salary. Mr. Adams is expected to work for 25 years. What is the
present value of the offer if the discount rate is 9 percent?

---

```{r problem 53 growing annuities; setup, echo=F}
p53 <- new.env()
p53$base.salary <- 55000
p53$immediate.bonus <- 10000
p53$bonus.modified.salary <- 55000*1.1
p53$g <- .035
p53$r <- .09
p53$n <- 25
p53$pv <- p53$immediate.bonus + p53$bonus.modified.salary / (1 + p53$r) *
    (1 + sum(((1 + p53$g) / (1 + p53$r))^(1:(p53$n - 1))))
```

## Given:

* The base salary: \$`r pretty(p53$base.salary)`

* Annual 10\% bonus a year, modifies the base salary:
$\$`r pretty(p53$base.salary, 0)` \times 1.10 =
\$`r pretty(p53$bonus.modified.salary, 0)`$. We will use this value to calculate
the growing annuity.

* Immediate \$`r pretty(p53$immediate.bonus, 0)` bonus for joining the company.
  This bonus is added to the present value, unmodified, because it is immediate.

$$
\begin{aligned}
\text{PV}_{\text{Offer}} &= `r pretty(p53$immediate.bonus, 0)` +
    `r pretty(p53$bonus.modified.salary)` \times \left[
    \frac{1 - \left(\frac{(1 + `r p53$g`)}
    {(1 + `r p53$r`)}\right)^{`r p53$n`}}{`r p53$r` - `r p53$g`}\right]\\
    &= `r pretty(p53$pv, 0)`
\end{aligned}
$$

---

# 54. Calculating Annuities

You have recently won the super jackpot in the Washington State Lottery. On
reading the fine print, you discover that you have the following two options:

a. You will receive 31 annual payments of \$250,000, with the first payment
being delivered today. The income will be taxed at a rate of 28 percent. Taxes
will be withheld when the checks are issued.

b. You will receive \$530,000 now, and you will not have to pay taxes on this
amount. In addition, beginning one year from today, you receive \$200,000 each
year for 30 years. The cash flows from this annuity will be taxed at 28 percent.

Using a discount rate of 7 percent, which option should you select?

---

We are comparing two options. The first option is a 31 year annuity due of
\$250,000. Each payment will have taxes taken out at a rate of 28 percent per
year.

The second option is a tax free upfront payment of \$530,000, with taxed
payments of \$200,000 a year as an ordinary annuity. This annuity will be taxed
at 28 percent.

```{r problem 54 calculating annuities; setup, echo=F}
p54 <- new.env()
p54$c.1 <- 250000
p54$c.2 <- 200000
p54$initial.2 <- 530000
p54$tax.rate <- .28
p54$r <- .07
p54$n.1 <- 31
p54$n.2 <- 30
p54$pv.1 <- p54$c.1 * (1 - p54$tax.rate) *
    (1 + sum((1 + p54$r)^(-(1:(p54$n.1-1)))))
p54$pv.2 <- p54$initial.2 + p54$c.2 * (1 - p54$tax.rate) *
    (sum((1 + p54$r)^(-(1:p54$n.2))))
```

## The first option (A pure annuity due)

$$
\begin{aligned}
\text{PV}_{\text{option 1}} &= \$`r pretty(p54$c.1, 0)`
    \times (1 - `r p54$tax.rate`) \times
    \left[1 + \frac{1 - (1 + `r p54$r`)^{-30}}{`r p54$r`}\right]\\
    &= \$`r pretty(p54$pv.1, 0)`
\end{aligned}
$$

## The second option (Immediate bonus with an ordinary annuity)

$$
\begin{aligned}
\text{PV}_{\text{option 2}} &= \$`r pretty(p54$initial.2, 0)` +
    \$`r pretty(p54$c.2, 0)` \times (1 - `r p54$tax.rate`)
    \times \left[\frac{1 - (1 + `r p54$r`)^{-30}}{`r p54$r`}\right]\\
    &= \$`r pretty(p54$pv.2, 0)`
\end{aligned}
$$

## Conclusion

Clearly the first option is the better option.

---

# 55. Calculating growing annuities

You have 30 years left until retirement and want to retire with \$2 million.
Your salary is paid annually, and you will receive \$70,000 at the end of the
current year. Your salary will increase at 3 percent per year, and you can earn
a return of 9 percent on the money you invest. If you save a constant percentage
of your salary, what percentage of your salary must you save each year?

---

```{r problem 55 calculating growing annuities; setup, echo=F}
p55 <- new.env()
p55$salary <- 70000
p55$r <- .09
p55$g <- .03
p55$n <- 30
p55$fv <- 2e6
p55$pvia <- function(r, g, n) (1 - ((1 + g)/(1 + r))^n) / (r - g)
p55$pvia.2 <- function(r, g, n) sum((1 + g)^(0:(n-1)) / (1 + r)^(1:n))

p55$fvga <- function(r, g, n) ((1 + r)^n - (1 + g)^n) / (r - g)
p55$fvga.2 <- function(r, g, n) sum((1 + g)^(0:(n-1)) * (1 + r)^((n-1):0))
p55$f <- function(p) p55$salary * p * p55$fvga(p55$r, p55$g, p55$n) - p55$fv
uniroot(p55$f, upper=5, lower=.01, tol=1e-2)$root
p55$f <- function(p) p55$salary * p * p55$fvga.2(p55$r, p55$g, p55$n) - p55$fv
uniroot(p55$f, upper=5, lower=.01, tol=1e-2)$root
```

We need to calculate the percentage saved to reach a future value of \$2
million.

We use the future value of a growing annuity formula.

The series formula for a growing annuity can be derived from the following
sequence:

## Deriving the formula for the future value of an annuity

The cash flow sequence:

$$
C, C(1 + g), C(1 + g)^{2}, \ldots, C(1 + g)^{n-1}
$$

## Future value formula

$$
\text{FV} = C(1 + g)^{0}(1 + r)^{n-1} + C(1 + g)^{1}(1 + r)^{n-2}
    + \cdots + C(1 + g)^{n-1}(1 + r)^0
$$

$$
\text{FV} = \sum_{k=0}^{n-1}{C(1 + g)^k (1 + r)^{n-1-k}}
$$

Factor out $C \cdot (1 + r)^{n-1}$:

$$
\text{FV} = C(1 + r)^{n-1} \sum^{n-1}_{k=0}{\left(\frac{1 + g}{1 + r}\right)^k}
$$


This is a geometric series with ratio $\frac{1+g}{1+r}$. The sum of the first
$n$ terms of a geomtric series is:

$$
\sum^{n-1}_{k=0}{x^k} = \frac{1 - x^n}{1 - x}, \text{ for } x \ne 1
$$

So:

$$
\sum^{n-1}_{k=0}\left(\frac{1 + g}{1 + r}\right)^k
  = \frac{1 - \left(\frac{1 + g}{1 + r}\right)^n}
         {1 - \left(\frac{1 + g}{1 + r}\right)}
$$

Doing some algebra:

$$
\begin{aligned}
\text{FV} &= C(1 + r)^{n-1} \cdot \frac{1 - \left({1 + g}{1 + r}\right)^n}
    {1 - \left(\frac{1 + g}{1+r}\right)}\\\\
    &= C (1 + r)^{n-1} \cdot \frac{1 - \left(\frac{1 + g}{1 + r}\right)^n}
        {\frac{r - g}{1 + r}}\\\\
    &= C \frac{(1 + r)^n - (1 + g)^n}{r - g}
\end{aligned}
$$

With this equation we can use `R`s `uniroot` function to find the percentage of
the salary that must be saved:

```{r}
p55$salary <- 70000
p55$r <- .09
p55$g <- .03
p55$n <- 30
p55$fv <- 2e6
# Future value factor depends on the discount rate, the growth rate, and the
# number of years we will be investing.
p55$fvga <- function(r, g, n) ((1 + r)^n - (1 + g)^n) / (r - g)
# Function used to determine the percent (p) of our salary to invest.
p55$f <- function(p) p55$salary * p * p55$fvga(p55$r, p55$g, p55$n) - p55$fv
# Uniroot will iterate over the function until it finds when the value is zero.
uniroot(p55$f, upper=5, lower=.01, tol=1e-2)$root
```

---

# 56. Balloon payments

On September 1, 2009, Susan Chao bought a motorcycle for \$30,000. She paid
\$1,000 down and financed the balance with a five-year loan at a stated annual
interest rate of 7.2 percent, compounded monthly. She started the monthly
payments exactly one month after the purchase (i.e., October 1, 2009). Two years
later, at the end of October 2011, Susan got a new job and decided to pay off
the loan. If the bank charges her a 1 percent prepayment penalty based on the
loan balance, how much must she pay the bank on November 1, 2011?

---

```{r problem 56 balloon payments; setup, echo=F}
p56 <- new.env()
p56$loan <- 30000 - 1000
p56$r <- .072
p56$n <- 5*12
p56$f <- function(c) c * (1 - (1 + p56$r/12)^(-p56$n))/(p56$r/12) - p56$loan
p56$factor <- (1 - (1 + p56$r/12)^(-p56$n))/(p56$r/12)
p56$payments <- round(uniroot(p56$f, upper=1000, lower=100, tol=10)$root, 2)
p56$n.paid <- 2*12
p56$balance <- p56$payments *
    (1 - (1 + p56$r/12)^(-(p56$n - p56$n.paid)))/(p56$r/12)
p56$balloon <- p56$balance * 1.01
```

## Determine the payments

For a 5-year loan of \$`r pretty(p56$loan,0)` at `r percent(p56$r)` APR. The
payments can be calculated:

$$
\begin{aligned}
`r pretty(p56$loan, 0)` &= C
\times \frac{\left[1 - (1 + `r p56$r/12`)^{`r p56$n`}\right]}{`r p56$r/12`}\\\\
C &= \frac{`r pretty(p56$loan, 0)`}{`r p56$factor`}\\
  &= `r pretty(p56$payments, 2)`
\end{aligned}
$$

## Amortize the loan

When Susan decided to pay off the loan she had already paid for `r p56$n.paid`
months.  The remaining term of the loan is `r p56$n - p56$n.paid` months. The bank
charges 1 percent prepayment penalty. The payment on November 1, 2011 will be:

$$
\begin{aligned}
\text{Payment} &= `r pretty(p56$payments, 2)`
    \times \frac{\left[1 - (1 + `r p56$r/12`)^{-`r p56$n - p56$n.paid`}\right]}
    {`r p56$r/12`} \times 1.01\\
    &= `r pretty(p56$balloon, 2)`
\end{aligned}
$$

Book: \$18,451.74

---

# 57. Calculating annuity values

Bilbo Baggins wants to save money to meet three objectives. First, he would like
to be able to retire 30 years from now with a retirement income of \$23,000 per
month for 20 years, with the first payment received 30 years and 1 month from
now. Second, he would like to purchase a cabin in Rivendell in 10 years at an
estimated cost of \$320,000. Third, after he passes on at the end of the 20
years of withdrawals, he would like to leave an inheritance of \$1,000,000 to
his nephew Frodo. He can afford to save \$2,100 per month for the next 10 years.
If he can earn an 11 percent EAR before he retires and an 8 percent EAR after he
retires, how much will he have to save each month in Years 11 through 30?

---

```{r problem 57: calculating annuity values; setup, echo=F}
p57 <- new.env()
p57$r.pre <- round((1 + .11)^(1/12) - 1, 6)
p57$r.post <- round((1 + .08)^(1/12) - 1, 6)
p57$pv.withdrawals <- 23000 * (1 - (1 + p57$r.post)^(-20*12)) / p57$r.post
p57$pv.inheritance <- 1e6 * (1 + p57$r.post)^(-20*12)
p57$pv.retirement <- p57$pv.withdrawals + p57$pv.inheritance
p57$savings.1 <- (2100 * ((1 + p57$r.pre)^(10*12) - 1)/p57$r.pre)
p57$savings.minus.cabin <- p57$savings.1 - 320000
p57$savings.for.20yrs <- p57$savings.minus.cabin * (1 + p57$r.pre)^(20*12)
p57$shortfall <- p57$pv.retirement -  p57$savings.for.20yrs
p57$payment.2 <- (p57$shortfall * p57$r.pre) / ((1 + p57$r.pre)^(20*12) - 1)
```

## Objectives summary

* __Retirement goal__: \$23,000/month for 20 years, starting 30 years + 1 month
  from now (i.e., at $t = 361 months).

* __Cabin purchase__: \$320,000 lump sum at year 10.

* __Inheritance: \$1,000,000 to Frodo at the end of withdrawals (i.e., 50 years
  from now).

* He saves \$21,000/month for 10 years.

* Must compute monthly savings from Year 11 to Year 30 (i.e., months 121 to
  360).

* EARs:

  - Before retirement (Years 1-30): 11\% EAR
  
  - After retirement (Years 31-50): 8\% EAR

## Step 1: Convert EARs to monthly rates.

We need monthly rates because all payments/savings are monthly.

* Before retirement

$$
r_{\text{pre}} = (1 + 0.11)^{1/12} - 1 \approx `r p57$r.pre`
$$

* After retirement:

$$
r_{\text{post}} = (1 + 0.08)^{1/12} - 1 \approx `r p57$r.post`
$$

## Step 2: Present value at retirement of retirement income + inheritance

We want the amount needed at $t = 360$ (30 years from now to:

1. Support 20 years of \$23,000/month withdrawals.

2. Leave \$1,000,000 at end of 50 years (i.e., at t = 600).

The PV at $t = 360$ of the withdrawals:

$$
\begin{aligned}
\text{PV}_{\text{withdrawals}} &= 23,000 \times \left[
    \frac{1 - (1 + r_{\text{post}})^{-240}}{r_{\text{post}}}\right]\\
    &= 23,000 \times \frac{1 - (1 + `r p57$r.post`)^{-240}}{`r p57$r.post`}\\
    \approx `r pretty(p57$pv.withdrawals)`
\end{aligned}
$$

The PV at $t = 360$ of the \$1,000,000 inheritance (i.e., 240 months later)

$$
\begin{aligned}
\text{PV}_{\text{inheritance}} = 1,000,000
  \times (1 + r_{\text{post}})^{-240}\\
  &= `r pretty(p57$pv.inheritance)`
\end{aligned}
$$

Total required at retirement ($t = 360$):

$$
\text{Needed}_{360} = \text{PV}_{\text{withdrawals}} +
  \text{PV}_{\text{inheritance}} \approx `r pretty(p57$pv.retirement)`
$$

## Step 3: Value of existing savings

This is a future value of an annuity with

* PMT = \$2,100
* n = 120
* r = 0.008746

$$
\begin{aligned}
\text{FV}_{10} &= 2,100 \times \frac{(1 + r)^{120} - 1}{r}
  &= `r pretty(p57$savings.1)`
\end{aligned}
$$

BUT---he uses this to buy a \$320,000 cabin at Year 10:

$$
\begin{aligned}
\text{Net FV}_{10} &= `r pretty(p57$savings.1)` - 320,000\\
  &= `r pretty(p57$savings.minus.cabin)`
\end{aligned}
$$

## Step 4: This balance grows for 20 more years (to year 30):

$$
\text{FV}_{30} = `r pretty(p57$savings.minus.cabin)`
  \times (1 + `r p57$r.pre`)^{-240} \approx
  `r pretty(p57$savings.for.20yrs)`
$$

## Step 5: Remaining needed at year 30

$$
\text{Shortfall}_{30} = `r pretty(p57$pv.retirement)`
  - `r pretty(p57$savings.for.20yrs)` = `r pretty(p57$shortfall)`
$$

## Step 6: Compute monthly savings needed in years 11-30

$$
\begin{aligned}
\text{FV} &= \text{PMT} \times \frac{(1 + r)^n - 1}{r} \Leftarrow
  \text{PMT} = \frac{FV \cdot r}{(1 + r)^n - 1}\\\\
\text{PMT} &= \frac{`r pretty(p57$shortfall)` \times `r p57$r.post`}
  {(1 + `r p57$r.post`)^{240} - 1}\\
  &\approx `r pretty(p57$payment.2)`
\end{aligned}
$$

---

# 58. Calculating annuity values

After deciding to buy a new car, you can either lease the car or purchase it
with a three-year loan. The car you wish to buy costs \$31,000. The dealer has a
special leasing arrangement where you pay \$1,500 today and \$405 per month for
the next three years. If you purchase the car, you will pay it off in monthly
payments over the next three years at an APR of 6 percent. You believe that you
will be able to sell the car for \$20,000 in three years. Should you buy or
lease the car?  What break-even resale price in three years would make you
indifferent between buying and leasing?

---

```{r problem 58: calculating annuity values; setup, echo=F}
p58 <- new.env()
p58$cost <- 31000
p58$resale <- 20000
p58$lease.today <- 1500
p58$lease.monthly.payments <- 405
p58$r <- .06 / 12
p58$t <- 3 * 12
p58$pvia <- function(r, t) (1 - (1 + r)^(-t))/r
p58$pv.lease <- 1500 + 405 * (1-(1+p58$r)^(-p58$t))/(p58$r)
p58$f <- function(c) c * p58$pvia(p58$r, p58$t) - p58$cost
p58$c <- uniroot(p58$f, upper=1000, lower=100, tol=1)$root
p58$pv.resale <- 20000 / (1 + p58$r)^(p58$t)
p58$pv.buying <- p58$cost - p58$pv.resale
p58$break.even <- uniroot(
    function(x) p58$cost - x / (1 + p58$r)^(p58$t) - p58$pv.lease,
    upper=31000,
    lower=1000,
    tol=10)$root
```

## Given

* To buy the car, it will cost \$`r pretty(p58$cost,0)`. You will pay off the
  car in monthly payments for three years at an APR of 6\%. You are confident
  you can sell the car for \$20,000 after three years.

* To lease the car, it will cost \$`r pretty(p58$lease.today,0)` upfront, and
  monthly payments of \$`r pretty(p58$lease.monthly.payments,0)` for three
  years.

## Option 1: Lease

* Upfront: \$`r pretty(p58$lease.today, 0)`

* Monthly lease payments: \$`r pretty(p58$lease.monthly.payments, 0)` for
  `r p58$t` months.

The PV of leasing the car is:

$$
\text{PV}_{\text{lease}} = `r pretty(p58$lease.today, 0)` +
  `r pretty(p58$lease.monthly.payments, 0)` \times
  \left[\frac{1 - (1 + `r p58$r`)^{-`r p58$t`}}{`r p58$r`}\right]
  \approx `r pretty(p58$pv.lease)`
$$

## Option 2: Buy

* Car price: \$31,000

* Loan: 6\% APR over 36 months

* Resale: \$20,000

### Monthly payments

The monthly payments can be calculated:

$$
\text{PMT} = \frac{P \cdot r}{1 - (1 + r)^{-n}}
  = \frac{`r pretty(p58$cost, 0)` \cdot `r p58$r`}
    {1 - (1 + `r p58$r`)^{-`r p58$t`}}
  \approx `r pretty(p58$c, 2)`
$$

The PV of the payments is just the \$31,000---you're buying the car, so that's
the up-front cost (financed, but paid off monthly).

The present value of resale in 3 years:

$$
\text{PV}_{\text{resale}} = \frac{`r pretty(p58$resale, 0)`}
    {(1 + `r p58$r`)^{`r p58$t`}}
  \approx `r pretty(p58$pv.resale, 0)`
$$

The net cost of buying the car:

$$
\text{Total PV}_{\text{buy}} = `r pretty(p58$cost, 0)` -
  `r pretty(p58$pv.resale, 0)` = `r pretty(p58$pv.buying, 0)`
$$

## Comparing leasing and buying:

* Lease: `r pretty(p58$pv.lease, 0)`

* Buy: `r pretty(p58$pv.buying, 0)`

In this demonstration, buying is cheaper than leasing.

## Break even resale value

$$
`r pretty(p58$cost, 0)` - \frac{X}{(1 + `r p58$r`)^{`r p58$t`}}
  = `r pretty(p58$pv.lease, 0)`
$$

Solving for X we get \$`r pretty(p58$break.even, 0)`.

---

# 59. Calculating annuity values

An All-Pro defensive lineman is in contract negotiations. The team has offered
the following salary structure:

```{r problem 59; setup, echo=F}
p59 <- new.env()
p59$T <- 0:6
p59$salary <- c(8.5e6, 3.9e6, 4.6e6, 5.3e6, 5.8e6, 6.4e6, 7.3e6)
p59$r <- .05
p59$m <- 365
knitr::kable(data.frame(Time = p59$T, Salary = pretty(p59$salary, 0)))
```

All salaries are to be paid in a lump sum. The player has asked you as his agent
to renegotiate the terms. He wants a \$10 million signing bonus payable today
and a contract value increase of \$1,500,000. He also wants an equal salary paid
every three months, with the first paycheck three months from now. If the
interest rate is 5 percent compounded daily, what is the amount of his quarterly
check? Assume 365 days in a year.

---

```{r problem 59; solution, echo=F}
p59$dr <- p59$r / p59$m
p59$pv.salary <- sum(p59$salary * (1 + p59$dr)^(-p59$m*p59$T))
p59$signing.bonus <- 10e6
p59$pv.negotiated.salary <- p59$pv.salary + 1.5e6
p59$pv.negotiated.quarters <- p59$pv.negotiated.salary - p59$signing.bonus
p59$qtrs <- 6*4
p59$T.qtr <- 1:24
p59$pvia <- sum((1 + p59$dr)^(-p59$m*p59$T.qtr))
p59$A <- p59$pv.negotiated.quarters / p59$pvia
```

With a five percent, compounded daily, interest rate, we have:

$$
\text{Daily Rate} = \frac{\text{Annual interest rate}}{365}
  = \frac{`r p59$r`}{365} = `r p59$dr`
$$

The present value of the original contract is:

$$
\begin{aligned}
\text{PV}_{\text{original}} &= \$`r pretty(p59$salary[1], 0)`
  + \frac{\$`r pretty(p59$salary[2], 0)`}
  {(1 + `r p59$dr`)^{-`r p59$m` \times `r p59$T[2]`}}
  + \frac{\$`r pretty(p59$salary[3], 0)`}
  {(1 + `r p59$dr`)^{-`r p59$m` \times `r p59$T[3]`}}
  + \frac{\$`r pretty(p59$salary[4], 0)`}
  {(1 + `r p59$dr`)^{-`r p59$m` \times `r p59$T[4]`}}\\
  &+ \frac{\$`r pretty(p59$salary[5], 0)`}
  {(1 + `r p59$dr`)^{-`r p59$m` \times `r p59$T[5]`}}
  + \frac{\$`r pretty(p59$salary[6], 0)`}
  {(1 + `r p59$dr`)^{-`r p59$m` \times `r p59$T[6]`}}
  + \frac{\$`r pretty(p59$salary[7], 0)`}
  {(1 + `r p59$dr`)^{-`r p59$m` \times `r p59$T[7]`}}\\\\
  &= \$`r pretty(p59$pv.salary, 0)`
\end{aligned}
$$

The new terms of the contract are:

* A \$10 million sign on bonus,

* an increase of \$1,500,000 in the contract value,

* and the payments made as an annuity every three months.

The value of the potential contract is:

$$
\begin{aligned}
\text{PV}_{\text{potential}} &= \text{PV}_{\text{original}} + \$1,500,000\\
  &= \$`r pretty(p59$pv.salary, 0)` + \$1,500,000\\
  &= \$`r pretty(p59$pv.negotiated.salary, 0)`
\end{aligned}
$$

To calculate the payments of the annuity, we need to remove the sign on bonus:

$$
\begin{aligned}
\text{PV}_{\text{annuity}} &= \text{PV}_{\text{potential}} - \$10,000,000\\
  &= \$`r pretty(p59$pv.negotiated.quarters, 0)`
\end{aligned}
$$

The payments will be every three months (quarterly) for 6 years `r p59$qtrs`.

We can calculate the present value interest factor for the quarterly annuity:

$$
\begin{aligned}
\text{PV}_{\text{annuity}} &= A * \text{PVIA}(r, T)\\\\
A &= \frac{\text{PV}_{\text{annuity}}}{\text{PVIA}(r, T)}\\\\
A &= \frac{\$`r pretty(p59$pv.negotiated.quarters)`}{`r p59$pvia`}\\\\
A &= \$`r pretty(p59$A, 0)`
\end{aligned}
$$

---

# 60. Discount Interest Loans

This question illustrates what is known as _discount interest_. Imagine you are
discussing a loan with a somewhat unscrupulous lender. You want to borrow
\$20,000 for one year. The interest rate is 15 percent. You and the lender agree
that the interest on the loan will be $.15 \times \$20,000 = \$3,000$. So, the
lender deducts this interest amount from the loan up front and gives you
$\$17,000$. In this case, we say that the discount is \$3,000. What's wrong
here?

---

```{r problem 60 setup, echo=F}
p60 <- new.env()
p60$loan <- 20e3
p60$r <- .15
```

The problem is. You think you are borrowing \$20,000 at 15\% for one year.

But in reality, you are only receiving \$17,000 (because \$3,000 is deducted as
"interest" up front). You must repay \$20,000 at the end of the year.

You are paying \$3,000 in interest on a loan of \$17,000, not \$20,000.

The actual effective interest rate is:

$$
\begin{aligned}
\text{Effective rate} &= \frac{\text{Interest paid}}
    {\text{amount actually received}}\\\\
    &= \frac{\$3,000}{\$17,000}\\\\
    &\approx 0.1765 = 17.65\%
\end{aligned}
$$

# 61. Calculating Annuity Values

You are serving on a jury. A plaintiff is suing the city for injuries sustained
after a freak street sweeper accident. In the trial, doctors testified that it
will be five years before the plaintiff is able ot return to work. The jury has
already decided in favor of the plaintiff. You are the foreperson of the jury
and propose that the jury give the plaintiff an award to cover the following:
(1) The present value of two years' back pay. The plaintiff's annual salary for
the last two years would have been \$37,000 and \$39,000, respectively. (2) The
present value of five years' future salary. You assume the salary will be
\$43,000 per year. (3) \$150,000 for pain and suffering. (4) \$25,000 for court
costs. Assume that the salary payments are equal amounts paid at the end of each
month. If the interest rate you choose is a 9 percent EAR, what is the size of
the settlement? If you were the plaintiff, would you like to see a higher or
lower interest rate?

---

```{r problem 61, echo=F}
p61 <- new.env()
p61$r <- .09
p61$backpay <- c(37e3, 39e3)
p61$pv.backpay <- {
    pv <- 0
    # first year's monthly payments months 1..12
    for(k in 1:12) pv <- pv + (p61$backpay[1]/12) / (1 + p61$r/12)^k
    # second year's monthly payments months 13..24
    for(k in 13:24) pv <- pv + (p61$backpay[2]/12) / (1 + p61$r/12)^k

    pv
}
```

1. Present value of two years back pay: \$37,000 and \$39,000.

For first year of backpay:

2. The present value of five years' of future salary (assume \$43,000 per year)

$$
\begin{aligned}
\text{PV}_{\text{future salary}} &= \$43,000 \times \frac{(1 + .09)^{2}}{.09}
\end{aligned}
$$
